<html devsite><head>
    <title>Como fazer o download da origem</title>
    <meta name="project_path" value="/_project.yaml"/>
    <meta name="book_path" value="/_book.yaml"/>
  </head>
  <body>
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>
  A árvore de origem do Android está localizada em um repositório Git hospedado pelo Google. O repositório Git contém metadados da origem do Android, incluindo aqueles relacionados a alterações da origem e à data em que foram feitas. Este documento descreve como fazer o download da árvore de origem para uma linha de código Android específica.
</p>
<p>
 Para iniciar com uma imagem de fábrica para um dispositivo específico, consulte <a href="running.html#selecting-device-build">Como selecionar uma versão de dispositivo</a>.
</p>
<h2 id="installing-repo">
  Como instalar o Repo
</h2>
<p>
  O Repo é uma ferramenta que facilita o trabalho com o Git no contexto do Android. Para ver mais informações sobre o Repo, consulte a <a href="../develop/repo.html">Referência de comando do Repo</a>.
</p>
<p>
  Para instalar o Repo:
</p>
<ol>
  <li>
    <p>
      Verifique se você tem um diretório <code>bin/</code> no seu diretório inicial e se ele está incluído no seu caminho:
    </p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">mkdir ~/bin</code>
<code class="devsite-terminal">PATH=~/bin:$PATH</code>
</pre>
  </li>
  <li>
    <p>
      Faça o download da ferramenta Repo e verifique se ela é executável:
    </p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</code>
<code class="devsite-terminal">chmod a+x ~/bin/repo</code>
</pre>
  </li>
</ol>
<p>
  Para a versão 1.21, a soma de verificação SHA-1 para o repo é <code>b8bd1804f432ecf1bab730949c82b93b0fc5fede</code>.
</p>
<p>
  Para a versão 1.22, a soma de verificação SHA-1 para o repo é <code>da0514e484f74648a890c0467d61ca415379f791</code>.
</p>
<p>
  Para a versão 1.23, a soma de verificação SHA-256 para o repo é <code>e147f0392686c40cfd7d5e6f332c6ee74c4eab4d24e2694b3b0a0c037bf51dc5</code>.
</p>
<h2 id="initializing-a-repo-client">
  Como inicializar um cliente do Repo
</h2>
<p>
  Depois de instalar o Repo, configure seu cliente para acessar o repositório de origem do Android:
</p>
<ol>
  <li>
    <p>
      Crie um diretório vazio para guardar seus arquivos de trabalho. Se você utiliza o MacOS, esse precisa ser um sistema de arquivos com distinção entre maiúsculas e minúsculas. Nomeie-o como quiser:
    </p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">mkdir WORKING_DIRECTORY</code>
<code class="devsite-terminal">cd WORKING_DIRECTORY</code>
</pre>
  </li>
  <li>
    <p>
      Configure o git com seu nome e endereço de e-mail reais. Para usar a ferramenta de revisão de código Gerrit, você precisará de um endereço de e-mail conectado a uma <a href="https://www.google.com/accounts">Conta do Google registrada</a>. Esse precisa ser um endereço ativo onde você possa receber mensagens. O nome que você fornecer aqui aparecerá em atribuições para os envios de código.
    </p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">git config --global user.name "Your Name"</code>
<code class="devsite-terminal">git config --global user.email "you@example.com"</code>
</pre>
  </li>
  <li>
    <p>
      Execute <code>repo init</code> para trazer a versão mais recente do Repo com todas as correções de bugs mais recentes. É preciso especificar um URL para o manifesto, que especifica onde os vários repositórios incluídos na origem do Android serão colocados no seu diretório de trabalho.
    </p>
<pre class="devsite-terminal devsite-click-to-copy">
repo init -u https://android.googlesource.com/platform/manifest
</pre>
    <p>
      Para fazer check-out de um branch diferente do "master", especifique-o com <code>-b</code>.
      Para ver uma lista de branches, consulte <a href="../start/build-numbers.html#source-code-tags-and-builds">Tags e versões de código-fonte</a>.
    </p>
<pre class="devsite-terminal devsite-click-to-copy">
repo init -u https://android.googlesource.com/platform/manifest -b android-4.0.1_r1
</pre>
  </li>
</ol>
<p>
  Uma inicialização bem-sucedida terminará com uma mensagem informando que o Repo foi inicializado no seu diretório de trabalho. Seu diretório cliente agora conterá um diretório <code>.repo</code> onde arquivos como o manifesto serão mantidos.
</p>
<h2 id="getting-the-files">
  Como fazer o download da árvore de origem do Android
</h2>
<p>
  Para receber a árvore de origem do Android para o diretório de trabalho dos repositórios, conforme especificado no manifesto padrão, execute
</p>
<pre class="devsite-terminal devsite-click-to-copy">repo sync</pre>
<p>
  Os arquivos de origem do Android se encontrarão no seu diretório de trabalho sob os nomes dos projetos. A operação de sincronização inicial levará uma hora ou mais para ser concluída. Para ver mais informações sobre <code>repo sync</code> e outros comandos Repo, consulte <a href="../develop/index.html">Desenvolvimento</a>.
</p>
<h2 id="using-authentication">
  Como usar a autenticação
</h2>
<p>
  Por padrão, o acesso ao código-fonte do Android é anônimo. Para proteger os servidores contra o uso excessivo, cada endereço IP é associado a uma cota.
</p>
<p>
  Ao compartilhar um endereço IP com outros usuários (por exemplo, ao acessar os repositórios de origem através de um firewall NAT), as cotas podem ser acionadas mesmo para padrões de uso regulares (por exemplo, se muitos usuários sincronizarem novos clientes do mesmo endereço IP em um curto período).
</p>
<p>
  Nesse caso, é possível usar o acesso autenticado, que utiliza uma cota separada para cada usuário, independentemente do endereço IP.
</p>
<p>
  O primeiro passo é criar uma senha com <a href="https://android.googlesource.com/new-password">o gerador de senhas</a> e seguir as instruções na página do gerador de senhas.
</p>
<p>
  O segundo passo é forçar o uso de acesso autenticado utilizando o seguinte URI de manifesto: <code>https://android.googlesource.com/a/platform/manifest</code>. Observe como o prefixo do diretório <code>/a/</code> aciona a autenticação obrigatória. Você pode converter um cliente existente para usar a autenticação obrigatória com o seguinte comando:
</p>
<pre class="devsite-terminal devsite-click-to-copy">
repo init -u https://android.googlesource.com/a/platform/manifest
</pre>
<h2 id="troubleshooting-network-issues">
  Como solucionar problemas de rede
</h2>
<p>
  Ao fazer o download por um proxy (o que é comum em alguns ambientes corporativos), pode ser necessário especificar explicitamente o proxy que será usado pelo Repo:
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">export HTTP_PROXY=http://&lt;proxy_user_id&gt;:&lt;proxy_password&gt;@&lt;proxy_server&gt;:&lt;proxy_port&gt;</code>
<code class="devsite-terminal">export HTTPS_PROXY=http://&lt;proxy_user_id&gt;:&lt;proxy_password&gt;@&lt;proxy_server&gt;:&lt;proxy_port&gt;</code>
</pre>
<p>
  Mais raramente, os clientes Linux enfrentam problemas de conectividade, ficando travados no meio de downloads (normalmente durante o "Recebimento de objetos"). Foi relatado que ajustar as configurações da pilha TCP/IP e usar comandos não paralelos pode melhorar a situação. É preciso acessar a raiz para modificar a configuração do TCP:
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">sudo sysctl -w net.ipv4.tcp_window_scaling=0</code>
<code class="devsite-terminal">repo sync -j1</code>
</pre>
<h2 id="using-a-local-mirror">
  Como usar um espelho local
</h2>
<p>
  Ao usar vários clientes, especialmente em situações em que a largura de banda é escassa, é melhor criar um espelho local de todo o conteúdo do servidor e sincronizar os clientes desse espelho (que não requer acesso à rede). O download de um espelho completo é menor que o de dois clientes, contendo mais informações.
</p>
<p>
  Estas instruções supõem que o espelho é criado em <code>/usr/local/aosp/mirror</code>. O primeiro passo é criar e sincronizar o espelho em si. Observe o sinalizador <code>--mirror</code>, que pode ser especificado apenas ao criar um novo cliente:
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">mkdir -p /usr/local/aosp/mirror</code>
<code class="devsite-terminal">cd /usr/local/aosp/mirror</code>
<code class="devsite-terminal">repo init -u https://android.googlesource.com/mirror/manifest --mirror</code>
<code class="devsite-terminal">repo sync</code>
</pre>
<p>
  Depois que o espelho é sincronizado, novos clientes podem ser criados com base nele. Observe que é importante especificar um caminho absoluto:
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">mkdir -p /usr/local/aosp/master</code>
<code class="devsite-terminal">cd /usr/local/aosp/master</code>
<code class="devsite-terminal">repo init -u /usr/local/aosp/mirror/platform/manifest.git</code>
<code class="devsite-terminal">repo sync</code>
</pre>
<p>
  Por fim, para sincronizar um cliente com o servidor, o espelho precisa ser sincronizado com o servidor e, em seguida, o cliente com o espelho:
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">cd /usr/local/aosp/mirror</code>
<code class="devsite-terminal">repo sync</code>
<code class="devsite-terminal">cd /usr/local/aosp/master</code>
<code class="devsite-terminal">repo sync</code>
</pre>
<p>
  É possível armazenar o espelho em um servidor LAN e acessá-lo via NFS, SSH ou Git. Também é possível armazená-lo em uma unidade removível e passar essa unidade para os usuários ou as máquinas.
</p>
<h2 id="verifying-git-tags">
  Como verificar as tags do Git
</h2>
<p>
  Carregue a seguinte chave pública para seu banco de dados de chaves do GnuPG. A chave é usada para assinar tags anotadas que representam versões.
</p>
<pre class="devsite-terminal devsite-click-to-copy">
gpg --import
</pre>
<p>
  Copie e cole a chave abaixo e, em seguida, insira EOF (Ctrl-D) para finalizar a entrada e processar as chaves.
</p>
<pre class="devsite-click-to-copy">
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.2.2 (GNU/Linux)

mQGiBEnnWD4RBACt9/h4v9xnnGDou13y3dvOx6/t43LPPIxeJ8eX9WB+8LLuROSV
lFhpHawsVAcFlmi7f7jdSRF+OvtZL9ShPKdLfwBJMNkU66/TZmPewS4m782ndtw7
8tR1cXb197Ob8kOfQB3A9yk2XZ4ei4ZC3i6wVdqHLRxABdncwu5hOF9KXwCgkxMD
u4PVgChaAJzTYJ1EG+UYBIUEAJmfearb0qRAN7dEoff0FeXsEaUA6U90sEoVks0Z
wNj96SA8BL+a1OoEUUfpMhiHyLuQSftxisJxTh+2QclzDviDyaTrkANjdYY7p2cq
/HMdOY7LJlHaqtXmZxXjjtw5Uc2QG8UY8aziU3IE9nTjSwCXeJnuyvoizl9/I1S5
jU5SA/9WwIps4SC84ielIXiGWEqq6i6/sk4I9q1YemZF2XVVKnmI1F4iCMtNKsR4
MGSa1gA8s4iQbsKNWPgp7M3a51JCVCu6l/8zTpA+uUGapw4tWCp4o0dpIvDPBEa9
b/aF/ygcR8mh5hgUfpF9IpXdknOsbKCvM9lSSfRciETykZc4wrRCVGhlIEFuZHJv
aWQgT3BlbiBTb3VyY2UgUHJvamVjdCA8aW5pdGlhbC1jb250cmlidXRpb25AYW5k
cm9pZC5jb20+iGAEExECACAFAknnWD4CGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIX
gAAKCRDorT+BmrEOeNr+AJ42Xy6tEW7r3KzrJxnRX8mij9z8tgCdFfQYiHpYngkI
2t09Ed+9Bm4gmEO5Ag0ESedYRBAIAKVW1JcMBWvV/0Bo9WiByJ9WJ5swMN36/vAl
QN4mWRhfzDOk/Rosdb0csAO/l8Kz0gKQPOfObtyYjvI8JMC3rmi+LIvSUT9806Up
hisyEmmHv6U8gUb/xHLIanXGxwhYzjgeuAXVCsv+EvoPIHbY4L/KvP5x+oCJIDbk
C2b1TvVk9PryzmE4BPIQL/NtgR1oLWm/uWR9zRUFtBnE411aMAN3qnAHBBMZzKMX
LWBGWE0znfRrnczI5p49i2YZJAjyX1P2WzmScK49CV82dzLo71MnrF6fj+Udtb5+
OgTg7Cow+8PRaTkJEW5Y2JIZpnRUq0CYxAmHYX79EMKHDSThf/8AAwUIAJPWsB/M
pK+KMs/s3r6nJrnYLTfdZhtmQXimpoDMJg1zxmL8UfNUKiQZ6esoAWtDgpqt7Y7s
KZ8laHRARonte394hidZzM5nb6hQvpPjt2OlPRsyqVxw4c/KsjADtAuKW9/d8phb
N8bTyOJo856qg4oOEzKG9eeF7oaZTYBy33BTL0408sEBxiMior6b8LrZrAhkqDjA
vUXRwm/fFKgpsOysxC6xi553CxBUCH2omNV6Ka1LNMwzSp9ILz8jEGqmUtkBszwo
G1S8fXgE0Lq3cdDM/GJ4QXP/p6LiwNF99faDMTV3+2SAOGvytOX6KjKVzKOSsfJQ
hN0DlsIw8hqJc0WISQQYEQIACQUCSedYRAIbDAAKCRDorT+BmrEOeCUOAJ9qmR0l
EXzeoxcdoafxqf6gZlJZlACgkWF7wi2YLW3Oa+jv2QSTlrx4KLM=
=Wi5D
-----END PGP PUBLIC KEY BLOCK-----
</pre>
<p>
  Depois de importar as chaves, você pode verificar qualquer tag com
</p>
<pre class="devsite-terminal devsite-click-to-copy">
git tag -v TAG_NAME
</pre>

</body></html>