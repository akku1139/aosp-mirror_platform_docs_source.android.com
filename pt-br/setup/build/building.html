<html devsite><head>
    <title>Como criar versões no Android</title>
    <meta name="project_path" value="/_project.yaml"/>
    <meta name="book_path" value="/_book.yaml"/>
  </head>
  <body>

  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>Siga estas instruções para começar a criar versões no Android.</p>

<h2 id="initialize">Configurar o ambiente</h2>
<p>Inicialize o ambiente com o script <code>envsetup.sh</code>. Observe que a substituição de <code>source</code> por <code>.</code> (um único ponto) economiza alguns caracteres, e o formato curto é mais comumente usado na documentação.</p>
<pre class="devsite-terminal devsite-click-to-copy">
source build/envsetup.sh
</pre>
<p>ou</p>
<pre class="devsite-terminal devsite-click-to-copy">
. build/envsetup.sh
</pre>

<p class="note">Será necessário reemitir esse comando após cada <code>repo sync</code> para detectar as alterações nesse script.</p>

<p>O script <code>envsetup.sh</code> importa vários comandos que permitem trabalhar com o código-fonte do Android, incluindo os comandos usados neste exercício. Veja a seguir alguns exemplos de comandos importantes:</p>

<ul>
<li><strong><code>lunch</code></strong>: <code>lunch
  <var>product_name</var>-<var>build_variant</var></code> seleciona <var>product_name</var> como o produto a ser criado e <var>build_variant</var> como a variante a ser criada, armazenando essas seleções no ambiente para serem lidas por invocações subsequentes de <code>m</code> e outros comandos parecidos.</li>
<li><strong><code>m</code></strong>: executa versões do topo da árvore.
Isso é útil porque você pode executar o <code>make</code> dentro de subdiretórios. Se você tiver a variável de ambiente <code>TOP</code> definida, ela será usada. Se você não tiver, o comando buscará a árvore no diretório atual para encontrar o topo dela. Você pode criar toda a árvore de código-fonte executando <code>m</code> sem argumentos ou criar destinos específicos definindo os nomes deles.</li>
<li><strong><code>mma</code></strong>: cria todos os módulos no diretório atual e as respectivas dependências.</li>
<li><strong><code>mmma</code></strong>: cria todos os módulos nos diretórios fornecidos e as respectivas dependências.</li>
<li><strong><code>croot</code></strong>: <code>cd</code> para o topo da árvore.</li>
</ul>

<p>Para ver a lista completa dos comandos disponíveis, execute:</p>

<pre class="devsite-terminal devsite-click-to-copy">
hmm
</pre>

<h2 id="choose-a-target">Escolher um destino</h2>
<p>Escolha qual destino criar com o <code>lunch</code>. A configuração exata pode ser passada como um argumento. Por exemplo, o comando a seguir se refere a uma versão completa para o emulador, com toda a depuração ativada:</p>
<pre class="devsite-terminal devsite-click-to-copy">
lunch aosp_arm-eng
</pre>
<p>Se executado sem argumentos, <code>lunch</code> solicitará que você escolha um destino no menu. Consulte <a href="/setup/build/running#selecting-device-build">Como selecionar uma versão do dispositivo</a> para ver as configurações de versão de todos os dispositivos existentes.</p>

<p>Todos os destinos de criação assumem o formato <code>BUILD-BUILDTYPE</code>, onde <code>BUILD</code> é um codinome que se refere à combinação específica de recursos. O <code>BUILDTYPE</code> é um dos seguintes.</p>
<table>
  <thead>
    <tr>
      <th>Tipo da versão</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user</td>
      <td>Acesso limitado; adequado para produção</td>
    </tr>
    <tr>
      <td>userdebug</td>
      <td>Como o user, mas com acesso root e capacidade de depuração; mais indicado para depuração</td>
    </tr>
    <tr>
      <td>eng</td>
      <td>Configuração de desenvolvimento com outras ferramentas de depuração</td>
    </tr>
  </tbody>
</table>

<p>A versão userdebug precisa se comportar da mesma forma que a user, com a capacidade de ativar depuração adicional, que normalmente viola o modelo de segurança da plataforma. Isso faz com que userdebug seja uma boa versão para testes de usuários com maiores recursos de diagnóstico. Ao desenvolver com a versão userdebug, siga as <a href="/setup/develop/new-device#userdebug-guidelines">diretrizes do userdebug</a>.</p>

<p>A versão eng prioriza a produtividade de engenharia para engenheiros que trabalham na plataforma. Ela desativa várias otimizações usadas para fornecer uma boa experiência ao usuário. Fora isso, a versão eng apresenta um comportamento semelhante ao das versões user e userdebug, para que os desenvolvedores de dispositivos possam ver como o código se comporta nesses ambientes.</p>

<p>Para ver mais informações sobre como criar e executar em hardwares reais, consulte <a href="/setup/build/running">Como executar versões</a>.</p>

<h2 id="build-the-code">Como compilar o código</h2>

<p>Esta seção é um breve resumo para garantir que a configuração esteja concluída.</p>

<p>Crie tudo com <code>m</code>. O <code>m</code> pode processar tarefas paralelas com um argumento <code>-jN</code>. Se você não fornecer um argumento <code>-j</code>, o sistema de versão selecionará automaticamente uma contagem de tarefas paralelas que seja considerada ideal para seu sistema.</p>

<pre class="devsite-terminal devsite-click-to-copy">
m
</pre>

<p>Como explicado acima, você pode criar módulos específicos em vez da imagem completa do dispositivo listando os nomes dos módulos na sua linha de comando <code>m</code>. Além disso, <code>m</code> oferece alguns pseudodestinos para fins especiais. Alguns exemplos:</p>

<ul>
<li><strong><code>droid</code></strong>: <code>m droid</code> é a versão normal. Esse destino está aqui porque o destino padrão requer um nome.</li>
<li><strong><code>all</code></strong>: <code>m all</code> cria tudo o que <code>m droid</code> faz, além de tudo o que não tem a tag <code>droid</code>. O servidor de versão o executa para garantir que tudo o que está na árvore e que tenha um arquivo <code>Android.mk</code> seja criado.</li>
<li><strong><code>clean</code></strong>: <code>m clean</code> exclui todos os arquivos intermediários e de saída para esta configuração. É o mesmo que <code>rm -rf out/</code>.</li>
</ul>

<p>Execute <code>m help</code> para ver o que outros pseudodestinos <code>m</code> oferecem.</p>

<h2 id="run-it">Executar</h2>

<p>Você pode executar sua versão em um emulador ou armazená-la em flash em um dispositivo.
 Como você já selecionou seu destino de versão com <code>lunch</code>, é improvável que ele seja executado em um destino diferente daquele para o qual foi criado.</p>

<aside class="note">
  <p><strong>Observação</strong>: lembre-se de adquirir os binários reservados, ou sua versão não será inicializada no hardware de destino. Às vezes, a fonte pode ter binários diferentes para versões e branches diferentes. Se você adquirir blobs binários neste ponto, será necessário desempacotá-los, <code>m installclean</code> e criá-los novamente. Para saber mais sobre esse processo, consulte <a href="/setup/build/downloading#obtaining-proprietary-binaries">Como fazer o download da origem</a>.
  </p>
</aside>

<h3 id="flash-a-device">Como realizar uma atualização flash com fastboot</h3>

<p>Para realizar uma atualização flash de um dispositivo, use <code>fastboot</code>, que precisa ser incluído no seu caminho após a criação ser concluída. Consulte <a href="/setup/build/running#flashing-a-device">Como realizar uma atualização flash em um dispositivo</a> para ver mais instruções.</p>

<h3 id="emulate-an-android-device">Como emular um dispositivo Android</h3>

<p>O emulador é adicionado ao seu caminho automaticamente pelo processo de criação. Para executá-lo, digite:</p>

<pre class="devsite-terminal devsite-click-to-copy">
emulator
</pre>

<h2 id="troubleshooting-common-build-errors">Como solucionar erros de criação comuns</h2>

<h3 id="wrong-java-version">Versão incorreta do Java</h3>

<p>Se você estiver tentando criar uma versão do Android inconsistente com sua versão do Java, <code>make</code> será cancelado com uma mensagem como:</p>

<pre>
************************************************************
You are attempting to build with the incorrect version
of java.

Your version is: WRONG_VERSION.
The correct version is: RIGHT_VERSION.

Please follow the machine setup instructions at
    https://source.android.com/source/initializing.html
************************************************************
</pre>

<p>Estas são as prováveis causas e soluções:</p>

<ul>
<li>Falha ao instalar o JDK correto conforme especificado nos <a href="/setup/build/requirements#jdk">Requisitos do JDK</a>. É necessário seguir as etapas apresentadas em <a href="/setup/build/building#initialize">Configurar o ambiente</a> e <a href="/setup/build/building#choose-a-target">Escolher um destino</a>.</li>
<li>Outro JDK instalado anteriormente aparece no seu caminho. Inclua o JDK correto no início do seu caminho ou remova o JDK problemático.</li>
</ul>

<h3 id="python-version-3">Versão 3 do Python</h3>

<p>O Repo foi projetado com uma funcionalidade específica do Python 2.x e é incompatível com o Python 3. Para usar o Repo, instale o Python 2.x:</p>

<pre class="devsite-terminal devsite-click-to-copy">
apt-get install python
</pre>

<h3 id="case-insensitive-filesystem">Sistema de arquivos indiferente a maiúsculas</h3>

<p>Se você estiver criando em um sistema de arquivos HFS no macOS, poderá encontrar um erro como:</p>
<pre>
************************************************************
You are building on a case-insensitive filesystem.
Please move your source tree to a case-sensitive filesystem.
************************************************************
</pre>
<p>Siga as instruções em <a href="/setup/build/initializing#creating-a-case-sensitive-disk-image">Como criar uma imagem de disco com diferenciação entre maiúsculas e minúsculas</a>.</p>

<h3 id="no-usb-permission">Sem permissão para USB</h3>

<p>Na maioria dos sistemas Linux, por padrão, os usuários sem privilégios não podem acessar as portas USB.
Se você encontrar um erro de permissão negada, siga as instruções em <a href="/setup/build/initializing#configuring-usb-access">Como configurar o acesso por USB</a>.</p>

<p>Se o adb já estava em execução e não consegue se conectar ao dispositivo após a configuração dessas regras, você pode eliminá-lo com <code>adb kill-server</code>.
Esse comando faz com que o adb seja reiniciado com a nova configuração.</p>

</body></html>