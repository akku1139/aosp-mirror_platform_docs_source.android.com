<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="device_discovery_and_assignment" class="page-title">设备发现和分配</h1>

<p>在 Android 10 中，<a href="/devices/neural-networks/">Neural Networks API (NNAPI)</a> 引入了一些功能，可让机器学习框架库和应用获取有关可用设备的信息，并指定在哪些设备上执行模型。通过向应用提供有关可用设备的信息，应用可以获取设备上安装的驱动程序的确切版本，从而避免出现已知的不兼容性。通过让应用能够指定执行模型不同部分的设备，应用可以针对目标部署产品进行优化。</p>

<p>NN HAL 1.2 的实现必须支持设备发现和分配。</p>

<h2 id="implement">实现</h2>

<p>为了支持 NNAPI 中的设备发现和分配功能，请在 <code>IDevice.hal</code> 中实现 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/refs/heads/master/neuralnetworks/1.2/IDevice.hal#76" class="external"><code>getType</code></a> 和 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/refs/heads/master/neuralnetworks/1.2/IDevice.hal#56" class="external"><code>getVersionString</code></a>，以便框架可以获取设备类型和驱动程序版本信息。</p>

<p>对于每种设备，请将类型指定为以下任一类别（如 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/refs/heads/master/neuralnetworks/1.2/types.hal" class="external"><code>types.hal</code></a> 内的 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/refs/heads/master/neuralnetworks/1.2/types.hal#4737" class="external"><code>DeviceType</code></a> 中所指定）。</p>

<ul>
<li><strong><code>OTHER</code></strong>：不属于任何其他类别的设备，它包括一个异构接口，该接口是一个管理多台设备（可能属于不同类型）的 <code>IDevice</code> 接口。具有异构接口的驱动程序还应公开与各设备对应的单独 <code>IDevice</code> 接口，以便应用可以从这些设备中进行选择。</li>
<li><strong><code>CPU</code></strong>：单核或多核 CPU。</li>
<li><strong><code>GPU</code></strong>：可以运行 NNAPI 模型以及加快图形 API（如 OpenGL ES 和 Vulkan）的速度的 GPU。</li>
<li><strong><code>ACCELERATOR</code></strong>：专用的神经处理单元 (NPU)。</li>
</ul>

<p>在 <code>IDevice.hal</code> 中实现 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/refs/heads/master/neuralnetworks/1.2/IDevice.hal#56" class="external"><code>getVersionString</code></a> 以获取设备实现的版本字符串。此方法必须返回一个可读性良好的字符串。字符串的格式特定于供应商。驱动程序的每个新版本的版本字符串必须不同。</p>

<p><code>IDevice</code> 接口的名称必须采用 <code>{VENDOR}-{DEVICE_NAME}</code> 格式。</p>

</body></html>