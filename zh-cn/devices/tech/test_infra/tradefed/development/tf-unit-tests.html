<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="include_unit_tests" class="page-title">包括单元测试</h1>

<p>本部分介绍如何在对项目做出更改后运行 Trade Federation 测试。这其中包括：</p>

<ul>
<li>在什么位置添加新的单元测试类</li>
<li>在 Eclipse 中以及 Eclipse IDE 外部运行单元测试</li>
<li>运行功能测试</li>
<li>在本地运行一些 TF 提交前验证</li>
</ul>

<h2 id="add_unit_tests">添加单元测试</h2>

<p>在 Android 开源项目 (AOSP) 中，您可以在以下位置添加单元测试类：<a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/tests/src/com/android/tradefed/UnitTests.java">tools/tradefederation/core/tests/src/com/android/tradefed/UnitTests.java</a></p>

<p>重要提示：将新的单元测试类添加到这些位置将导致它们在提交前自动运行，而无需额外设置。</p>

<h2 id="run_unit_tests">运行单元测试</h2>

<p>Trade Federation 的所有 AOSP 单元测试和功能测试都位于 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/tests/"><code>tools/tradefederation/core/tests</code></a> 项目中。</p>

<p>在 Eclipse 中，要运行单个单元测试，只需右键点击该测试，然后依次选择 <strong>Run As&gt; JUnit</strong>。要运行所有单元测试，请运行 <strong>com.android.tradefed.UnitTests</strong> 套件。</p>

<p>您也可以在编译之后从 Tradefed 源代码树中的命令行启动单元测试，如下所示：<code>tools/tradefederation/core/tests/run_tradefed_tests.sh</code></p>

<p>单元测试可以单独执行，但功能测试应使用 Trade Federation 本身执行；它们需要 Android 设备。所有功能测试都应遵循命名惯例 <code>*FuncTest</code>。</p>

<h2 id="run_functional_tests">运行功能测试</h2>

<p>要从 Eclipse 中运行功能测试，请执行以下操作：</p>

<ol>
<li>确保一个设备已连接到主机，并且 <code>adb</code> 和（如有必要）<code>fastboot</code> 在 Eclipse 的 PATH 中。要达到此目的，最简单的方法是从具有正确 PATH 的 shell 设置启动 Eclipse。</li>
<li>创建一个 Java 应用。通过依次点击 <strong>Run &gt; Run configurations</strong> 运行配置。</li>
<li>将项目设为 <code>google-tradefederation-tests</code>，并将主类设为 <code>com.android.tradefed.command.CommandRunner</code>。</li>
<li><em></em>在“Arguments”标签中提供以下命令行参数：<code>host
--class &lt;full path of test class to run&gt;</code></li>
<li>点击 <strong>Run</strong>。</li>
</ol>

<p>要在 Eclipse 外部运行功能测试，请执行以下操作：</p>

<ol>
<li>编译 Trade Federation。</li>
<li>将一个 Android 设备连接到主机。</li>
<li>运行 <code>tools/tradefederation/core/tests/run_tradefed_func_tests.sh</code></li>
<li>（可选）通过附加显示在 <code>adb devices</code> 输出中的 <code>--serial &lt;serial no&gt;</code> 来选择相应设备。</li>
</ol>

<h2 id="running_tf_presubmit_tests_against_local_changes">针对本地更改运行 TF 提交前测试</h2>

<p>如果您想以与 TF 提交前测试相似的方式运行，请使用以下命令：</p>
<pre class="prettyprint"><code>tools/tradefederation/core/tests/run_tradefed_aosp_presubmit.sh
</code></pre>
<p>此命令会针对本地编译的 TF 触发所有 TF 提交前测试，以帮助您验证相应更改未破坏任何测试。</p>

<p>TF 提交前测试是上述单元测试的超集，但运行速度偏慢。因此，建议在开发期间运行单元测试以更快速地进行验证，然后在上传 CL 之前运行提交前测试。</p>

</body></html>