<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="employ_module_controllers" class="page-title">采用模块控制器</h1>

<p>每个套件模块（由 <code>AndroidTest.xml</code> 定义）均可包含一个特殊的 <code>module_controller</code> 对象，该对象可以改变模块的某种行为：</p>

<h2 id="whether_to_run_the_module_or_not_based_on_some_conditions">是否根据某些条件运行模块</h2>

<p>通过实现 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/testtype/suite/module/BaseModuleController.java">BaseModuleController</a> 并将其添加到 <code>AndroidTest.xml</code>，如下所示：</p>
<pre class="prettyprint lang-xml"><code>&lt;object type="module_controller" class="com.android.tradefed.testtype.suite.module.&lt;NAME&gt;" /&gt;
</code></pre>
<p>模块控制器将用于根据 <code>public abstract RunStrategy shouldRun(IInvocationContext context);</code> 实现来确定是否应运行相应模块。</p>

<h2 id="whether_to_collect_some_logs_or_not_on_failures">是否收集某些故障日志</h2>

<p>运行完整套件时，可以在套件级别请求收集某些故障日志（屏幕截图、错误报告和 logcat）。但对于某些模块来说，请求的特定日志可能没有任何价值，收集该日志只是在浪费时间。在这种情况下，模块可以明确指定它们关注的日志：</p>
<pre class="prettyprint lang-xml"><code>&lt;object type="module_controller"
        class="com.android.tradefed.testtype.suite.module.TestFailureModuleController"&gt;
    &lt;option name="screenshot-on-failure" value="&lt;true OR false&gt;" /&gt;
    &lt;option name="bugreportz-on-failure" value="&lt;true OR false&gt;" /&gt;
    &lt;option name="logcat-on-failure" value="&lt;true OR false&gt;" /&gt;
&lt;/object&gt;
</code></pre>
<p>注意：控制器的实现应尽可能通用，以便最大限度地提高可重用性。如果根据模块条件跳过某个模块，应由模块所有者审核，得到他们的批准，确认跳过模块是正确的行为。</p>

</body></html>