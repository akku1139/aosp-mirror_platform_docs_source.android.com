<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="automatic_test_retry" class="page-title">自动重新运行测试</h1>

<p>测试可能会因任何原因而失败，有时只需重新运行测试就足以使其再次通过（由于不稳定性，例如底层基础架构中的问题）。您可以将 Tradefed 配置为自动重试。</p>

<p>自动重试的核心是避免重新运行<strong>所有</strong>测试；它仅会重新运行失败的测试，从而大大缩短了执行时间。</p>

<p>Tradefed 还支持多次运行测试，以便通过<strong>迭代</strong>功能检测不稳定性。在这种情况下，系统将重新运行所有测试，如果任何迭代失败了，测试将失败。</p>

<h2 id="enabling_the_feature">启用自动重试功能</h2>

<p>自动重试通过 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/master/src/com/android/tradefed/retry/BaseRetryDecision.java">RetryDecision 对象</a>控制，该对象提供两个选项来启用该功能：<code>max-testcase-run-count</code> 和 <code>retry-strategy</code>。</p>

<p><code>max-testcase-run-count</code> 指定将尝试的重试次数或迭代次数。它会设置上限以避免永久重试。
<code>retry-strategy</code> 指定如何重试；如需了解详情，请参阅以下部分。</p>

<h2 id="retrying_failures">重试失败的测试</h2>

<p>要重试失败的测试，请使用以下选项：</p>
<pre class="prettyprint lang-shell"><code>--retry-strategy RETRY_ANY_FAILURE --max-testcase-run-count X
</code></pre>
<p>上述命令将重试失败的测试，直到测试通过或直至达到重试次数上限，以先到者为准。</p>

<h2 id="iterations">迭代</h2>

<p>要重新运行测试多次，请使用以下选项：</p>
<pre class="prettyprint lang-shell"><code>--retry-strategy ITERATIONS --max-testcase-run-count X
</code></pre>
<h2 id="what_do_the_results_look_like">结果如何？</h2>

<p>默认情况下，结果报告程序将收到所有尝试的汇总结果。</p>

<p>例如：<code>RETRY_ANY_FAILURE</code> 为 <code>Fail</code> 和 <code>Pass</code> 会生成汇总的 <code>Pass</code>，因为重试设法清除了失败的测试。</p>

<p>报告程序可能会收到非汇总结果。为此，它们需要扩展 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/master/src/com/android/tradefed/result/retry/ISupportGranularResults.java">ISupportGranularResults 接口</a>，以声明对精细（非汇总）结果的支持。</p>

</body></html>