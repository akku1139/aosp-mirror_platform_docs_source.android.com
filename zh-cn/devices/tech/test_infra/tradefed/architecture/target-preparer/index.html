<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="target_preparers" class="page-title">目标准备器</h1>

<p>目标准备器在定义它们的<a href="/devices/tech/test_infra/tradefed/testing/through-suite/setup#definitions">测试级别</a>中的测试之前调用。这样，您就可以设置任何设备，以使测试顺畅地运行。</p>

<h2 id="base_interface">基接口</h2>

<p>基接口是 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/targetprep/ITargetPreparer.java">ITargetPreparer</a>，用于实现将要执行的 <code>setUp</code> 方法。建议您实现我们的基本抽象类 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/targetprep/BaseTargetPreparer.java">BaseTargetPreparer</a>，它提供了内置的停用功能来轻松停用准备器。</p>

<h2 id="cleaner_interface">清理器接口</h2>

<p><code>setUp</code> 的自然扩展是 <code>tearDown</code>，该扩展由另一个接口 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/targetprep/ITargetCleaner.java">ITargetCleaner</a> 提供。它提供了 <code>tearDown</code> 接口，用于在测试执行后清理在 <code>setUp</code> 中所做的任何设置。</p>

<p><code>BaseTargetPreparer</code> 类也扩展了 <code>ITargetCleaner</code>。</p>

<h2 id="recommendations">建议</h2>

<p>我们建议每个准备器限定于一项主要功能，例如安装 APK 或运行命令。这样，就可以更容易地重复使用准备器。</p>

<p>您还应该在添加新的准备器之前检查可用准备器的列表，以避免重复工作。准备器位于 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/targetprep/">tools/tradefederation/core/src/com/android/tradefed/targetprep/</a>。</p>

<h2 id="xml_configuration">XML 配置</h2>

<p>对象标记将为 <code>target_preparer</code>，例如：</p>
<pre class="prettyprint lang-xml"><code>&lt;target_preparer class="com.android.tradefed.targetprep.InstallApkSetup"&gt;
    &lt;option name="install-arg" value="-d"/&gt;
&lt;/target_preparer&gt;
</code></pre>
<p>有关上下文，另请参阅<a href="/devices/tech/test_infra/tradefed/testing/through-suite/setup">套件设置</a>。</p>

<h3 id="top-level_setup">顶级设置</h3>

<p>如果是在顶级设置中指定的准备器，则准备器将仅针对每个设备运行一次。例如 <a href="https://android.googlesource.com/platform/test/suite_harness/+/refs/heads/master/tools/cts-tradefed/res/config/cts-common.xml">cts-common.xml</a>，它是 Android 兼容性测试套件 (CTS) 测试的顶级设置。</p>

<h3 id="module-level_setup">模块级设置</h3>

<p>如果是在模块级设置中指定的准备器，则准备器将始终在该模块之前运行。例如 <a href="https://android.googlesource.com/platform/cts/+/refs/heads/master/tests/backup/AndroidTest.xml">backup/AndroidTest.xml</a>，它定义 Tradefed 如何运行 <code>backup</code> CTS 模块。</p>

<p>请注意，虽然准备器将在相应模块之前运行，但会在所有<a href="/devices/tech/test_infra/tradefed/testing/through-suite/system-status-checker">系统状态检查工具</a>之后运行。<em></em></p>

</body></html>