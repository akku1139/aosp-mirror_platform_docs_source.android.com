<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="store_secrets_with_keystore" class="page-title">使用密钥库存储密钥</h1>

<p>Tradefed 包含<a href="/security/keystore">密钥库</a>的概念，该概念是指可以将密钥存储在密钥库服务中，还可以在测试运行时请求密钥，以便在测试期间使用。</p>

<h2 id="how_to_use_the_keystore">如何使用密钥库</h2>

<p>要使用密钥库，您需要先在<a href="/devices/tech/test_infra/tradefed/architecture/advanced/global-config">全局配置</a>中定义密钥库的源。</p>

<p>完成后，即可通过 <code>USE_KEYSTORE@{key}</code> 使用存储的密钥。</p>

<h2 id="jsonfilekeystore">JSONFileKeyStore</h2>

<p>Tradefed 核心中的实现示例使用了一个 JSON 密钥库，即 <code>JSONFileKeyStoreClient</code>。要使用此密钥库，您应定义一个包含键值映射的 JSON 密钥文件。</p>

<p>例如，您可以将 <code>/path/to/keystore.json</code> 文件定义为：</p>
<pre class="prettyprint lang-json"><code>{
  "test_account": "foo@gmail.com",
  "test_account_pwd": "helloworld",
  "wifi_lab_ssid": "Google_private_AP",
  "wifi_lab_pwd": "secret123",
}
</code></pre>
<p>然后，您应在 TF 全局配置文件中添加以下行：</p>
<pre class="prettyprint lang-xml"><code>&lt;key_store class="com.android.tradefed.util.keystore.JSONFileKeyStoreFactory"&gt;
&lt;option name="json-key-store-file" value="/path/to/keystore.json" /&gt;
&lt;/key_store&gt;
</code></pre>
<p>在执行相关测试时，您现在可以将值作为 <code>USE_KEYSTORE@test_account</code> 传入，TF 随后会从密钥库中查询该键，并将其值用作测试的一部分。</p>

</body></html>