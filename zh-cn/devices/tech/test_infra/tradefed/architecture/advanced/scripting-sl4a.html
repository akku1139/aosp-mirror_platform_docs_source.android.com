<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="using_trade_federation_with_scripting_layer_for_android" class="page-title">将 Trade Federation 与 Android 脚本层一起使用</h1>

<p>Android 脚本层（即 SL4A）是一个自动化工具集，用于以独立于平台的方式调用 Android API。它既支持通过 <code>adb</code> 实现远程自动化，又支持通过一系列轻量级转换层从设备上执行脚本。</p>

<p>该项目位于 <a href="https://android.googlesource.com/platform/external/sl4a/">platform/external/sl4a</a>。</p>

<h2 id="use">使用</h2>

<p>您可以按照 <a href="https://android.googlesource.com/platform/external/sl4a/+/refs/heads/master/README.md">SL4A README</a> 手动编译并安装 SL4A。在通过 Tradefed 运行时，您可以利用一些自动化测试框架实用程序，使之更易于使用。</p>

<h3 id="download_and_install">下载并安装</h3>

<p>您可以首先查看 <a href="https://android.googlesource.com/platform/tools/tradefederation/contrib/+/refs/heads/master/res/config/google/example/BT-discovery-sl4a.xml">BT-discovery-sl4a.xml</a>，这是一个使用两部设备的 Tradefed 配置示例。大多数设备版本的 <code>tests</code> 文件夹中都有 <code>SL4A.apk</code>。</p>

<p>上述 Tradefed 示例将自动获取相应版本，刷写这两部设备并在这两部设备上安装 <code>SL4A.apk</code>。您可以这样运行：</p>
<pre class="prettyprint"><code>source build/envsetup.sh
lunch
make sl4a
tradefed.sh run google/example/BT-discovery-sl4a
</code></pre>
<p>或者，在编译后，运行以下命令：</p>
<pre class="prettyprint"><code>./tradefed.sh run google/example/BT-discovery-sl4a
</code></pre>
<h3 id="write_a_test_in_tradefed_using_sl4a">使用 SL4A 在 Tradefed 中编写测试</h3>

<p>您可以按照上述测试样本 <a href="https://android.googlesource.com/platform/tools/tradefederation/contrib/+/refs/heads/master/src/com/android/tradefed/Sl4aBluetoothDiscovery.java">Sl4aBluetoothDiscovery.java</a> 来编写。该样本给出了一个很好的例子，说明了在 Tradefed 测试中使用 SL4A 的流程。</p>

<h3 id="sl4a_api_documentation">SL4A API 文档</h3>

<p>可以生成通过 SL4A 提供的回调的完整列表。从 SL4A 源目录 <code>platform/external/sl4a/</code> 中，运行以下命令：</p>
<pre class="prettyprint lang-shell"><code>python Docs/generate_api_reference_md.py
</code></pre>
<p>在 Docs 目录中，将有一个 <code>ApiReference.md</code> 文件，其中包含 SL4A 中可用的 RPC 函数，以及这些 RPC 函数的文档。</p>

</body></html>