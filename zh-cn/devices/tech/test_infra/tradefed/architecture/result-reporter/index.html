<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="creating_a_new_result_reporter" class="page-title">创建新的结果报告程序</h1>

<p>本部分介绍如何实现新的结果报告程序并针对测试对其进行配置的基础知识。</p>

<h2 id="core_interface">核心接口</h2>

<p>为了在 Tradefed 中定义新的结果报告程序，一个类必须实现 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/result/ITestInvocationListener.java">ITestInvocationListener</a> 接口，该接口允许接收和处理调用的不同阶段：</p>

<ul>
<li>invocationStarted</li>
<li>invocationEnded</li>
<li>invocationFailed</li>
</ul>

<p>结果报告程序还处理每个测试运行的不同阶段：</p>

<ul>
<li>testRunStarted</li>
<li>testStarted</li>
<li>testFailed/testIgnored</li>
<li>testEnded</li>
<li>testRunFailed</li>
<li>testRunEnded</li>
</ul>

<p>考虑到所有这些事件，结果报告程序主要有两种类型，其特点分别是：</p>

<ul>
<li>只关心报告最终完整结果。</li>
<li>对部分结果执行操作。</li>
</ul>

<h3 id="result_reporter_that_reports_final_complete_results">报告最终完整结果的结果报告程序</h3>

<p>当涉及到与接收结果的外部服务进行交互时，此类型是最常见的情况。此类报告程序只是接收并累积结果，然后在 <code>invocationEnded</code> 时将结果全部发送到结果端点。</p>

<p>建议此类报告程序扩展 <code>CollectingTestListener</code> 而不是基接口，以避免在 <code>invocationEnded</code> 之前重复实现结果的保存和存储。</p>

<h3 id="result_reporter_that_reports_partial_results">报告部分结果的结果报告程序</h3>

<p>当接收结果并立即将其推送到其他一些位置时，此类型通常用于结果的流式传输方法。例如，将结果记录到控制台的报告程序就属于此类型。</p>

<p>此类型特定于需要对事件进行哪种类型的处理，因此通常建议实现基接口。</p>

<h3 id="xml_configuration">XML 配置</h3>

<p>对象标记将为 <code>result_reporter</code>。例如：</p>
<pre class="prettyprint lang-xml"><code>&lt;result_reporter class="com.android.tradefed.result.ConsoleResultReporter"&gt;
    &lt;option name="suppress-passed-tests" value="true"/&gt;
&lt;/result_reporter&gt;
</code></pre>

</body></html>