<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="device_states_in_tradefed" class="page-title">Tradefed 中的设备状态</h1>

<h2 id="android_devices">Android 设备</h2>

<p>Tradefed 中的 Android 设备可以经历通过设备管理器提供的几种状态。Android 设备有两大类状态：分配状态和在线状态。</p>

<p>您可以使用 <code>l d</code> 或 <code>list devices</code> 在 <a href="/devices/tech/test_infra/tradefed/fundamentals/console">Tradefed 控制台</a>中检查所有这些状态。</p>
<pre class="prettyprint"><code>tf &gt;l d
Serial        State         Allocation   Product   Variant   Build    Battery
84TX0081B     ONLINE        Available    blueline  blueline  MASTER   100
HT6550300002  ONLINE        Available    sailfish  sailfish  MASTER   94
876X00GNG     UNAUTHORIZED  Unavailable  unknown   unknown   unknown  unknown
HT6570300047  UNAUTHORIZED  Unavailable  unknown   unknown   unknown  unknown
</code></pre>
<h3 id="allocation_states">分配状态</h3>

<p>分配状态是 Tradefed 特有的状态，用于监控设备使用情况。这种状态由 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/remote/src/com/android/tradefed/device/DeviceAllocationState.java">DeviceAllocationState</a> 进行描述，可以是以下任意一项：</p>

<ul>
<li>UNKNOWN：过渡期间使用的中间状态，用于决定是否应从跟踪列表中移除设备。当某个设备与 <code>adb</code> 断开连接时，会发生这种情况。</li>
<li>IGNORED：无法为 TF 会话选择设备，因为已将其过滤掉。TF 很可能是在导出了 <code>ANDROID_SERIAL</code> 的情况下启动的，因此限制了可以选取的设备的范围。</li>
<li>AVAILABLE：设备已可供您为测试选择。</li>
<li>UNAVAILABLE：设备已连接，但尚未准备好运行测试。此状态通常在 <code>adb</code> 中显示为 <code>offline</code>。</li>
<li>ALLOCATED：设备当前正在运行测试，无法选择。</li>
<li>CHECKING_AVAILABILITY：设备刚刚连接，TF 检查它是否正常在线且可供使用。如果不正常在线，将无法使用。</li>
</ul>

<h3 id="online_states">在线状态</h3>

<p>在线状态表示 <code>adb devices</code> 看到的设备的实际状态。这种状态由 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/refs/heads/master/src/com/android/tradefed/device/TestDeviceState.java">TestDeviceState</a> 进行描述，可以是：</p>

<ul>
<li>FASTBOOT</li>
<li>ONLINE</li>
<li>RECOVERY</li>
<li>NOT_AVAILABLE</li>
</ul>

<p>Tradefed 在线状态关联到我们使用的底层 <code>adb</code> 库，即 <code>ddmlib</code>。该库使用 <a href="https://android.googlesource.com/platform/tools/base/+/refs/heads/master/ddmlib/src/main/java/com/android/ddmlib/IDevice.java">DeviceState</a> 来描述状态。</p>

</body></html>