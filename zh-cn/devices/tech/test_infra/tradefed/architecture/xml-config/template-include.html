<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="templates_and_includes_in_tradefed_xml_configuration" class="page-title">Tradefed XML 配置中的模板和包含</h1>

<p>创建一个单体式 XML 配置来定义测试并不总是切实可行。如果要重复使用部分设置来运行类似的测试，您将不得不复制和维护两个巨大的 XML 文件。</p>

<p>这就是 Tradefed XML 配置定义中的 <code>template</code> 和 <code>include</code> 标记的用武之地。这些标记允许您在某个 XML 配置中设置占位符，以添加另一个 XML 配置的一部分。</p>

<h2 id="example_definition_for_templates">模板定义示例</h2>
<pre class="prettyprint lang-xml"><code>&lt;configuration description="Common base configuration for local runs with minimum overhead"&gt;
    &lt;build_provider class="com.android.tradefed.build.BootstrapBuildProvider" /&gt;

    &lt;template-include name="preparers" default="empty" /&gt;

    &lt;template-include name="test" default="empty" /&gt;

    &lt;template-include name="reporters" default="empty" /&gt;
&lt;/configuration&gt;
</code></pre>
<p>模板是占位符，具有用来引用它们的 <code>name</code>，以及一个可选的 <code>default</code> 字段。该默认字段定义应使用的默认替换 XML。</p>

<p>要用给定的配置替换模板，需要将以下命令参数添加到命令行：</p>
<pre class="prettyprint"><code>--template:map &lt;name of template&gt;=&lt;replacement XML config path&gt;

--template:map preparers=empty
</code></pre>
<p>例如：</p>
<pre class="prettyprint"><code>&lt;template-include name="preparers" default="empty" /&gt;
</code></pre>
<p>本例中的 <code>empty</code> 引用是指不包含任何内容的 <code>empty.xml</code> 配置。我们将其用作参考，将模板替换为空内容。<em></em></p>

<p>XML 配置的路径可以是 Tradefed 的 JAR 资源内 <code>res/config</code> 文件夹的绝对路径或相对路径。下面是它们的一些位置：</p>

<ul>
<li>tools/tradefederation/core/res/config</li>
<li>tools/tradefederation/core/tests/res/config</li>
<li>tools/tradedeferation/contrib/res/config</li>
</ul>

<h2 id="example_definition_of_includes">包含定义示例</h2>
<pre class="prettyprint lang-xml"><code>&lt;configuration description="Common base configuration for local runs with minimum overhead"&gt;
    &lt;build_provider class="com.android.tradefed.build.BootstrapBuildProvider" /&gt;

    &lt;include name="empty"/&gt;
&lt;/configuration&gt;
</code></pre>
<p>包含比模板更简单，因为它们不需要命令行参数，而是直接扩展 <code>name</code> 标记中引用的 XML。与模板类似，配置的路径可以是绝对路径或相对路径。不过，对于 <code>includes</code>，我们建议仅使用相对路径，因为相对路径在 Tradefed 中的可移植性更高。如果将 Tradefed 移至另一台机器，绝对路径将无效。</p>

<h2 id="misconfiguration">错误配置</h2>

<p>如果出现错误配置（如无法找到替换 XML），Tradefed 将抛出 <code>ConfigurationException</code>，并说明有哪些内容可能缺失或配置错误。</p>

</body></html>