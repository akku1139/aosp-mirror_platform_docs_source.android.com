<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2018 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="carrier_identification" class="page-title">识别运营商</h1>

<p>搭载 Android 9 的设备可以识别订阅运营商信息，以提供相应 ID 和运营商名称。Android 维护着一个运营商 ID 数据库，该数据库采用每个运营商对应其唯一运营商 ID 的匹配规则。AOSP 在 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.textpb" class="external"><code>carrier_list.textpb</code></a> 文件中包含运营商 ID 数据库的内容。统一的数据库有助于最大限度地减少需要识别运营商的应用内的重复逻辑，并限制暴露可用于识别运营商的属性。</p>

<p>为了更准确地识别更多运营商，Android 支持带外运营商 ID 表更新。每个更新版本都会有一个版本号，并会发布到 AOSP。</p>

<h2 id="implementation">实现</h2>

<p>想要实现带外更新的用户可以从 AOSP 下载 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.pb" class="external"><code>carrier_list.pb</code></a> 二进制文件。要查看该表的用户可读懂格式，请参阅 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.textpb" class="external"><code>carrier_list.textpb</code></a>。</p>

<p>将运营商 ID 表放到设备的 <code>/data/misc/carrierid/</code> 数据分区中。如果运营商 ID 表新于现有版本，则设备会将该表保留到<a href="https://developer.android.com/reference/android/provider/Telephony.CarrierId">运营商 ID 数据库类</a>中。运营商 ID 数据库中的最新信息会通过公共方法 <a href="https://developer.android.com/reference/android/telephony/TelephonyManager#getSimCarrierId()" class="external"><code>getSimCarrierId()</code></a> 和 <a href="https://developer.android.com/reference/android/telephony/TelephonyManager#getSimCarrierIdName()" class="external"><code>getSimCarrierIdName()</code></a> 获取。</p>

<h2 id="adding_carrier_id_information_to_the_database">向数据库添加运营商 ID 信息</h2>

<p>要向数据库添加运营商 ID 或更新其中的运营商 ID，请使用
<a href="https://docs.google.com/forms/d/1KjwTaExKRjkE9tbR9yavBrGzwvuz1dNku2Ae_7GrdUQ/viewform?edit_requested=true" class="external">运营商标识信息表单</a>提交申请。</p>

<p>我们会审核您的申请，如果予以批准，则会将更改推送到 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.pb" class="external"><code>carrier_list.pb</code></a> 处的 AOSP 代码库。接下来，您可以复制更新列表并将其整合到您的自定义编译系统中。</p>

<h2 id="integrating_carrier_ids_with_carrierconfig">将运营商 ID 与 CarrierConfig 集成</h2>

<p>从 Android 10 开始，<a href="/devices/tech/config/carrier">运营商配置</a>支持将运营商 ID 用作密钥，从 <a href="https://developer.android.com/reference/android/service/carrier/CarrierService" class="external"><code>CarrierService</code></a> 获取运营商专属配置。</p>

<p>将运营商 ID 与 <code>CarrierConfig</code> 集成具有以下优势：</p>

<ul>
<li>将每个运营商的所有 MCC/MNC 对整合到一个位置，从而移除重复或不一致的数据。</li>
<li>为每个运营商创建规范标识符并消除歧义。</li>
<li>允许使用单个 ID 标识移动虚拟网络运营商 (MVNO)，而不是将配置作为移动网络运营商 (MNO) 的一部分。</li>
</ul>

<h3 id="migrating_configuration_data_to_carrier_ids">将配置数据迁移到运营商 ID</h3>

<p>要将配置数据从 MCC/MNC 对迁移到运营商 ID，请按以下步骤操作：</p>

<ol>
<li><p>将单个运营商的 <code>carrier_config_mccmnc.xml</code> 文件组合在一起。使用 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.textpb" class="external"><code>carrier_list.textpb</code></a> 作为参考，将 MCC、MNC 和 MVNO 信息映射到特定运营商。</p></li>
<li><p>将配置合并到单个文件中。</p></li>
<li><p>（可选）从 MNO 沿用数据。MVNO 从旧版 <code>carrier_config_mccmnc.xml</code> 文件的 MNO 中沿用配置。由于运营商 ID 允许包括 MVNO 在内的所有运营商拥有专属配置文件，因此建议在迁移期间包含 MNO 数据。</p></li>
<li><p>如果 MVNO 运营商 ID 的配置不存在，请使用 <a href="https://developer.android.com/reference/android/telephony/TelephonyManager#getCarrierIdFromSimMccMnc()" class="external"><code>getCarrierIdFromSimMccMnc</code></a> 从其 MNO 运营商 ID 中获取配置。</p></li>
<li><p>将新文件重命名为 <code>carrier_config_carrierid_<var>carrierid</var>_<var>carriername</var>.xml</code>，其中 carrierid 必须对应于 <code>canonical_id</code>，carriername 应对应于 <a href="https://android.googlesource.com/platform/packages/providers/TelephonyProvider/+/master/assets/carrier_list.textpb" class="external"><code>carrier_list.textpb</code></a> 中的 <code>carrier_name</code><var></var><var></var> </p></li>
</ol>
<aside class="note"><strong>注意：</strong><span>如果 <code>carrier_config_mccmnc</code> 文件没有匹配的运营商 ID，请按照<a href="#adding_carrier_id_information_to_the_database">向数据库添加运营商 ID 信息</a>中的步骤提交添加运营商 ID 的申请。</span></aside>

</body></html>