<html devsite><head>
    <title>Android 权限</title>
    <meta name="project_path" value="/_project.yaml"/>
    <meta name="book_path" value="/_book.yaml"/>
  </head>
  <body>

    {% include "_versions.html" %}
    
<!--
  Copyright 2018 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<p>Android 权限系统提供的控件可提高用户对应用权限的认知，还可以限制应用对敏感数据的访问。在 Android 8.0 及更低版本中配置权限的过程包括将应用列入白名单。如果有特权应用未列入白名单，则即使它们位于 <code>priv-app</code> 路径中，也一样会被停用。在 Android 9 及更高版本上，如果设备尝试使用未正确列入白名单的应用，则系统将无法正常启动。</p>

<p>这些针对<a href="https://developers.google.com/android/play-protect/potentially-harmful-applications" class="external">可能有害的应用</a> (PHA) 的增强型防护措施有助于：</p>

<ul>
<li>更好地了解可能有害的应用的行为。</li>
<li>加强用户对应用行为的控制。</li>
<li>让应用开发者在使用受权限保护的私人数据时更加谨慎。</li>
</ul>

<h3 id="package-install-and-permission">软件包安装和权限</h3>

<p>在 Android 9 及更低版本中，软件包安装和权限控制功能包含在 <code>PackageInstaller</code> 软件包 (<code>//packages/apps/PackageInstaller</code>) 中。在 Android {{androidQVersionNumber }} 及更高版本中，权限控制功能位于单独的软件包 <code>PermissionController</code> (<code>//packages/apps/PermissionController</code>) 中。<a href="#package-install">图 1</a> 显示了这两个软件包在 Android 10 中的位置。</p>

<figure id="package-install"><img src="/devices/tech/config/images/package-install.png" width="90%" alt="将系统应用的软件包安装和权限控制功能与用户安装的应用使用的此类功能分开"/> <figcaption><strong>图 1. </strong> Android {{ androidQVersionNumber}} 中的软件包安装和权限控制功能</figcaption></figure>

<h3 id="whitelists-and-access">白名单和权限</h3>

<p>在 Android 6.0 及更高版本中，应用会在<a href="/devices/tech/config/runtime_perms">运行时</a>申请危险权限。Android 10 增加了具备活动识别 (AR) 能力的运行时权限机制，可提示用户修改或允许危险权限。</p>

<p>Android 8.0 要求您在系统配置 XML 文件（位于 <code>/etc/permissions</code> 目录下）中明确将特权应用列入白名单。在 Android 9 及更高版本中，特许权限必须<a href="/devices/tech/config/perms-whitelist">列入白名单</a>，否则设备无法启动。</p>

<p>为了限制内部 API 的可见性并防止应用意外地访问平台库，Android 7.0 推出了<a href="/devices/tech/config/namespaces_libraries">针对原生库的命名空间</a>。这将系统库与应用库分离开来，而设备制造商可以添加自己的原生库。</p>

<p>从 Android 10 开始，应用必须拥有签名权限并征得用户同意才能<a href="/devices/tech/config/restricted-screen-reading">访问设备的屏幕内容</a>，两者缺一不可。依赖于静默捕获功能（如截取屏幕截图）的特权应用应改为使用 <a href="https://developer.android.com/reference/android/media/projection/MediaProjection" class="external">MediaProjection</a> 类。</p>

<h3 id="transparency-and-privacy">透明度和隐私权</h3>

<p>Android 6.0 及更高版本会阻止 WLAN 服务提供方和数据包分析器访问设备的出厂 MAC 地址。自 Android 10 起，还有其他一些限制条件会限制应用访问<a href="/devices/tech/config/immutable-device-ids">不可变设备标识符 (ID)</a>，除非相应应用<a href="/devices/tech/config/perms-whitelist">已列入特许权限白名单</a>。（<a href="/devices/tech/connect"><strong>连接</strong></a>部分提供了有关<a href="/devices/tech/config/device-identifiers">设备标识符</a>的相关讨论，因为该内容会对运营商产生影响。）</p>

<p>在 Android 9 及更低版本中，用户在向应用授予位置信息访问权限时做出的选择是永久性的。从 Android 10 开始，<a href="/devices/tech/config/tristate-perms">三态位置信息权限</a>功能为用户提供了三个选项，用来控制应用如何访问设备的位置信息。无论目标 SDK 设置如何，这些权限要求都适用于 Android 10 中的应用。</p>

<p>从 Android 10 开始，您需要配置其他透明度和隐私权功能的权限</p>

<ul>

  <li><a href="/devices/tech/config/background-location-access">后台位置信息访问权限</a>提醒会向用户显示某个应用何时在后台使用 <code><a href="https://developer.android.com/reference/android/Manifest.permission#ACCESS_FINE_LOCATION" class="external">
ACCESS_FINE_LOCATION</a></code> 权限访问了其设备位置信息。</li>

  <li>由联系人提供器组件管理的联系人亲密程度相关数据的访问方式有所不同：应用无法向数据库中写入<a href="/devices/tech/config/contacts-affinities">联系人亲密程度</a>数据，也无法读取此类数据。这会影响<a href="/devices/tech/config/contacts-affinities#APIchanges">与来电者相关的 API</a>。</li>
</ul>

<h3 id="streamlined-configurations">经过简化的配置</h3>

<p>Android 6.0 及更高版本中的权限配置已经过简化。</p>

<ul>

  <li>由 <code>init</code> 启动的服务的 <a href="/devices/tech/config/ambient">Ambient 权能</a>可将服务配置的所有方面的信息保存在单个 <code>.rc</code> 文件中。在为并非由 <code>init</code> 所启动的服务设置权能时，请改为使用 <code>fs_config.c</code> 来配置文件系统权能。</li>

  <li>Android 7.x 及更低版本使用设备专属的 <code>android_filesystem_config.h</code> 文件来指定文件系统权能和/或自定义设备制造商 AID，从而扩展了 Android ID (AID) 机制。Android 8.0 及更高版本支持采取一种<a href="/devices/tech/config/filesystem">新方法来扩展文件系统权能</a>。</li>

  <li>Android 8.0 将 USB 命令的处理从设备专属的 <code>init</code> 脚本（替代 HAL 层）移至了原生 USB 守护进程。必须在搭载 Android 8.0 及更高版本的每台设备上实现 <a href="/devices/tech/config/usb-hal">USB HAL</a> 接口。</li>
</ul>

</body></html>