<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>

<!--
  Copyright 2018 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="native_tests" class="page-title">原生测试</h1>

<p>如前所述，原生测试通常用于执行 HAL 或直接与较低级别的系统服务交互，要利用连续测试服务，应使用 <a href="https://github.com/google/googletest">gtest</a> 框架编译原生测试。</p>

<p>下面是一些常规说明：</p>

<ol>
<li>参阅示例原生测试模块设置，位于：<code>libs/hwui/unit_tests</code></li>
<li>测试模块 makefile 应使用 <code>BUILD_NATIVE_TEST</code> 编译规则，以便自动包含 gtest 依赖项</li>
<li>编写<a href="test-config.md">测试配置</a>。</li>
<li><p>使用 <code>mmm</code> 或 <code>mma</code>（取决于它是增量编译还是完整编译）编译测试模块，例如：</p>
<pre class="prettyprint lang-shell"><code>make hwui_unit_tests -j
</code></pre></li>
<li><p>使用 <a href="https://android.googlesource.com/platform/tools/tradefederation/+/master/atest/README.md">Atest</a> 运行测试：</p>
<pre class="prettyprint"><code>atest hwui_unit_tests
</code></pre></li>
<li><p>或者，使用 Trade Federation 自动化测试框架运行：</p>
<pre class="prettyprint"><code>make tradefed-all -j
tradefed.sh run template/local_min --template:map test=hwui_unit_tests
</code></pre></li>
<li><p>如果使用 Trade Federation，请手动安装并运行：</p>

<ol>
<li><p>将生成的测试二进制文件推送到设备：</p>
<pre class="prettyprint lang-shell"><code>adb push ${OUT}/data/nativetest/hwui_unit_tests/hwui_unit_tests \
  /data/nativetest/hwui_unit_tests/hwui_unit_tests
</code></pre></li>
<li><p>通过在设备上调用测试二进制文件执行测试：</p>
<pre class="prettyprint lang-shell"><code>adb shell /data/nativetest/hwui_unit_tests/hwui_unit_tests
</code></pre></li>
</ol>

<p>这样将启动原生测试。您还可以将 <code>--help</code> 参数添加到测试二进制文件，以详细了解自定义测试执行的不同方式。最后，请参阅 <a href="https://github.com/google/googletest/blob/master/googletest/docs/advanced.md">gtest 高级指南</a>，以了解更多参数及其用法。</p></li>
</ol>

</body></html>