<html devsite><head>

  <meta name="book_path" value="/_book.yaml"/>

  <meta name="project_path" value="/_project.yaml"/>
</head>
<body>
<!--
  Copyright 2019 The Android Open Source Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<h1 id="rack-mount_sensor_fusion_controller_assembly" class="page-title">机架式传感器融合控制器组装</h1>

<p>本页介绍了如何组装机架式传感器融合测试装置的控制器布线板。传感器融合测试是<a href="/compatibility/cts">兼容性测试套件</a> (CTS) 中<a href="/compatibility/cts/camera-its-box">相机图像测试套件</a>（相机 ITS）的一部分。当多个传感器融合装置由单个主机控制时（例如在实验室环境中），您可以使用机架式传感器融合控制器。</p>

<h2 id="rack-mount_sensor_fusion_controller_overview">机架式传感器融合控制器概览</h2>

<h3 id="sensor_fusion_test_rig">传感器融合测试装置</h3>

<p>传感器融合测试装置让手机在固定范围内移动，以进行可重现的测试。对着拍摄目标旋转手机，以便在不同位置拍摄图片。</p>

<p>测试装置将手机围绕摄像头轴中心旋转 90 度，并在大约 2 秒内将手机旋转回原位。图 1 显示了一部手机在传感器融合测试装置中移动。</p>

<p><img src="/compatibility/cts/images/rack-sensor-fusion-video.gif" alt="测试装置中的手机移动" width="250"/> </p>

<p><strong>图 1.</strong> 测试装置中的手机移动</p>

<h3 id="servo_motor_control">伺服电机控制</h3>

<p>测试装置中的模拟伺服电机是采用脉冲宽度调制 (PWM) 控制的位置伺服系统。图 2 显示了一个典型的位置控制示例。控制信号的周期为 20 毫秒。如果将脉冲宽度更改为最小宽度，电机移动会到空挡位置；如果将脉冲宽度更改为最大宽度，电机会逆时针旋转 90 度。</p>

<p><img src="/compatibility/cts/images/rack-servo-control.png" alt="伺服控制说明" width="450"/> </p>

<p><strong>图 2.</strong> 典型的伺服控制说明</p>

<h3 id="sensor_fusion_controller_implementation">传感器融合控制器实现</h3>

<p>为了通过主机控制伺服电机移动，传感器融合测试装置需要 USB 连接。测试装置控制器使用一个已连接 USB 的 CanaKit UK1104 继电器板，它具有四个继电器输出端。继电器板的输出端连接到 SparkFun WIG-13118 伺服触发器。CanaKit 板如下图 3 所示，SparkFun 板如图 4 所示。CanaKit 板由外部 12V 电源供电。SparkFun 伺服触发器的供电电压为 5V，因为伺服电机使用 5V 电源。SparkFun 伺服触发器可实现平稳移动。</p>

<p><img src="/compatibility/cts/images/rack-usb-relay-controller.png" alt="CanaKit UK1104 USB 继电控制器俯视图" width="450"/> </p>

<p><strong>图 3.</strong> CanaKit UK1104 USB 继电控制器（俯视图）</p>

<p><img src="/compatibility/cts/images/rack-sparkfun.png" alt="SparkFun WIG-13118 伺服控制器俯视图" width="150"/> </p>

<p><strong>图 4.</strong> SparkFun WIG-13118 伺服控制器（俯视图）</p>

<p>传感器融合控制器实现采用焊接布线组装而成，以连接 CanaKit 板和 SparkFun 板。电路原理图如图 5 所示。4 根电线采用手动焊接，通道 1 上提供单个伺服控制输出端。SparkFun 伺服控制器所需的 5V VCC 不受 CanaKit 内部 12V 到 5V 调节器的控制。线路简单，可以实现较高产量。</p>

<p><img src="/compatibility/cts/images/rack-controller.png" alt="传感器融合控制器" width="700"/> </p>

<p><strong>图 5.</strong> 传感器融合控制器修订版 1，显示了单个传感器融合盒控制器</p>

<h3 id="rack-mount_sensor_fusion_controller">机架式传感器融合控制器</h3>

<p>借助机架式实现，可以采用单个主机控制多个测试装置，从而降低了实验室成本。现有的 CanaKit 继电器板最多可以控制 4 个伺服触发器。机架式实现增加了外部调节器和旁路电容器，用于处理来自新增伺服触发器的额外电流负荷。原理图如图 6 所示。与图 5 中的单通道传感器融合控制器相比，除了伺服触发器之间的 VCC/GND 连接之外，机架式控制器还需要至少 10 根电线。虽然可以手工接线，但组装过程容易出错。因此，机架式实现改为采用自定义布线板。</p>

<h3 id="sensor_fusion_routing_pcb">传感器融合布线 PCB</h3>

<p>为了缩短组装时间、提高产量和简化重新组装，我们采用自定义印刷电路板 (PCB) 在两块板之间布线，并提供一个安装基板。采用布线 PCB 完成互连，可以用压铆螺母柱将最终系统固定到一起，这样在拆卸时就不会损坏相关组件。</p>

<p>采用开源在线 PCB 设计工具设计的两层布线板可以在以下位置获得：<a href="https://easyeda.com/portmannc/sensor_fusion" class="external">https://easyeda.com/portmannc/sensor_fusion</a>。</p>

<p>布线板尺寸大约为 4.0 英寸 x 2.2 英寸，与 CanaKit 板的尺寸大致相同。建议采用 1.6 毫米厚的布线板，以确保机械稳定性。</p>

<p><img src="/compatibility/cts/images/rack-rack-mount-controller.png" alt="机架式传感器融合控制器" width="700"/> </p>

<p><strong>图 6.</strong> 机架式传感器融合控制器</p>

<p>布线板的设计目的是连接 CanaKit 继电控制器和 SparkFun 伺服控制器。布线板的底部如图 7 所示。丝网印刷采用白色丝网，内部布线采用浅绿色线。每个角落附近都有一个用白色圆圈圈出的孔，这是为了在安装时与 CanaKit 板上的孔对齐。请注意电源调节器和电容器的轮廓。调节器电容器 C1 和 C2 是 10 uF 钽质电容器，如 <a href="http://www.ti.com/lit/ds/symlink/lm1084.pdf" class="external">LM1084 数据表</a>中所述。通过板载调节器，会将 12V 的电源电压下调为 +5V 的供电电压（不需要散热器，因为调节器最多可以吸收 390 毫安电流，而且调节器下方的布线板上下都覆有铜层）。</p>

<p>4 个继电器输出端的连接 (NO[1:4]) 以及 COM[1:4] 连接显示在布线板底部。此外，从 CanaKit 板到伺服控制器板的主 GND 连接标示在布线板顶部的中间位置。所有标示的孔都应该以母形针座填充，以便连接到下面的 CanaKit UK1104 板。</p>

<p><img src="/compatibility/cts/images/rack-routing-board-bottom.png" alt="传感器融合布线板修订版 1.1 仰视图" width="450"/> </p>

<p><strong>图 7.</strong> 传感器融合布线板修订版 1.1，显示了布线和电源电路（仰视图）</p>

<p>传感器融合布线板的顶部如图 8 所示。图中显示了 WIG-13118 伺服触发器板和孔的轮廓。虽然每个伺服触发器板都有 4 个孔，但每个伺服触发器只需要两个压铆螺母柱（已用白色圆圈圈出）。VCC 和 GND 分别连接到每个伺服触发器，因此如果需要，不一定要填充 4 个伺服触发器。左侧有两个连接器的轮廓，这些连接器对于机架式传感器融合控制器不是必需的。</p>

<p><img src="/compatibility/cts/images/rack-routing-board-top.png" alt="传感器融合布线板修订版 1.1 俯视图" width="450"/> </p>

<p><strong>图 8.</strong> 传感器融合布线板修订版 1.1，显示了布线（俯视图）</p>

<h2 id="assembling_a_rack-mount_sensor_fusion_controller">组装机架式传感器融合控制器</h2>

<h3 id="bill_of_materials_bom">材料清单 (BOM)</h3>

<table>
  <tbody><tr>
    <th>数量</th>
    <th>说明</th>
   <th>部件号/链接</th>
  </tr>
  <tr>
    <td>1</td>
    <td>1.6 毫米厚的传感器融合布线板</td>
    <td><a href="https://easyeda.com/portmannc/sensor_fusion" class="external">https://easyeda.com/portmannc/sensor_fusion</a></td>
  </tr>
  <tr>
    <td>4</td>
    <td>SparkFun WIG-13118 伺服触发器</td>
    <td><a href="https://www.sparkfun.com/products/13118" class="external">https://www.sparkfun.com/products/13118</a></td>
  </tr>
  <tr>
    <td>1</td>
    <td>CanaKit UK1104 继电控制器</td>
    <td><a href="https://www.canakit.com/4-port-usb-relay-controller.html" class="external">https://www.canakit.com/4-port-usb-relay-controller.html</a></td>
  </tr>
  <tr>
    <td>1</td>
    <td>Texas Instruments LM1084 5V，5A LDO 调节器</td>
    <td><a href="http://www.ti.com/lit/ds/symlink/lm1084.pdf" class="external">http://www.ti.com/lit/ds/symlink/lm1084.pdf</a></td>
  </tr>
  <tr>
    <td>2</td>
    <td>16V，10%，10 uF 钽质电容器</td>
    <td><a href="https://www.digikey.in/product-detail/en/avx-corporation/TAP106K016CRS/478-13137-2-ND/9948471" class="external">TAP106K016CRS</a></td>
  </tr>
  <tr>
    <td>5</td>
    <td>1 排 3 脚，间距 100 密耳（2.54 毫米），通孔母形针座</td>
    <td><a href="https://www.digikey.com/product-detail/en/harwin-inc/M20-7820346/952-1784-ND/3727753" class="external">952-1784-ND</a></td>
  </tr>
  <tr>
    <td>8</td>
    <td>1 排 2 脚，间距 100 密耳（2.54 毫米），通孔母形针座</td>
    <td><a href="https://www.digikey.com/product-detail/en/harwin-inc/M20-7820246/952-1776-ND/3727745" class="external">952-1776-ND</a></td>
  </tr>
  <tr>
    <td>10</td>
    <td>1 排 3 脚，间距 100 密耳（2.54 毫米），通孔公形针座，其中四个拆除了中间的引脚，可以实现 200 密耳（5.08 毫米）的间距</td>
    <td><a href="https://www.digikey.com/product-detail/en/harwin-inc/M20-9994046/952-3308-ND/3921305" class="external">952-3308-ND</a></td>
  </tr>
  <tr>
    <td>9</td>
    <td>1 排 2 脚，间距 100 密耳（2.54 毫米），通孔公形针座</td>
    <td><a href="https://www.digikey.com/product-detail/en/harwin-inc/M20-9994046/952-3308-ND/3921305" class="external">952-3308-ND</a></td>
  </tr>
  <tr>
    <td>12</td>
    <td>11 毫米母形对母形压铆螺母柱（5 毫米宽，M3-0.5 螺纹）</td>
    <td><a href="https://www.mouser.com/ProductDetail/Harwin/R30-1001102?qs=%252Bk6%2F5FB6qrnRFlGPReP7GQ%3D%3D" class="external">R30-1001102</a></td>
  </tr>
  <tr>
    <td>4</td>
    <td>16 毫米公形对母形压铆螺母柱（5 毫米宽，M3-0.5 螺纹）</td>
    <td><a href="https://www.mouser.com/ProductDetail/Harwin/R30-3001602?qs=sGAEpiMZZMtrde5aJd3qw4L16p8RLiBxUnqbxrYelA0%3D" class="external">R30-3001602</a></td>
  </tr>
  <tr>
    <td>20</td>
    <td>M3-0.5 6 毫米螺钉</td>
    <td><a href="https://www.digikey.com/product-detail/en/keystone-electronics/9191-3/36-9191-3-ND/4499484" class="external">36-9191-3-ND</a></td>
  </tr>
</tbody></table>

<h3 id="other_tools_needed">所需的其他工具</h3>

<ul>
<li>焊铁、焊料、吸锡器</li>
<li>小号十字头螺丝刀</li>
<li>尖嘴钳</li>
<li>美工刀</li>
<li>精密钻头：0.8 毫米（1/32 英寸），或 67 号标准钻头</li>
</ul>

<h3 id="other_resources">其他资源</h3>

<p>以下 zip 文件可供下载。</p>

<ul>
<li><a href="/compatibility/cts/images/rack-mount_sensor_fusion_controller_enslosure_production_files.zip">机架式传感器融合控制器封装生产文件</a></li>
<li><a href="/compatibility/cts/images/gerber_rack_mount_sensor_fusion_routing_board_rev1_1.zip">Gerber 机架式传感器融合布线板（修订版 1.1）</a></li>
</ul>

<h3 id="populating_the_routing_board">填充布线板</h3>

<p>在布线板顶部，安装 2 脚母形针座，以便连接上方的 WIG-13118 板。每对 VCC/GND 和 IN[1:4]/GND 都需要一个 2 脚母形针座。在布线板底部，需要在每对 NO[1:4]/GND 上以及 POWER 和 GND 孔上分别安装 3 脚母形针座。此外，必须要填充调节器和电容器。已填充布线板的概念化侧视图如图 9 所示。</p>

<p><img src="/compatibility/cts/images/rack-populated-board-side.png" alt="已填充布线板的侧视图" width="350"/> </p>

<p><strong>图 9.</strong> 使用母形针座、调节器和电容器填充的布线板（概念化侧视图）</p>

<p>已填充布线板的图片如图 10（俯视图）和图 11（仰视图）所示。</p>

<p><img src="/compatibility/cts/images/rack-populated-board-top.png" alt="已填充布线板俯视图" width="450"/> </p>

<p><strong>图 10.</strong> 已填充布线板修订版 1.1（俯视图）</p>

<p><img src="/compatibility/cts/images/rack-populated-board-bottom.png" alt="已填充布线板仰视图" width="450"/> </p>

<p><strong>图 11.</strong> 已填充布线板修订版 1.1（仰视图）</p>

<h3 id="preparing_the_canakit_and_sparkfun_servo_boards_for_assembly">CanaKit 和 SparkFun 伺服板组装准备工作</h3>

<p>要将 CanaKit 连接到布线板，您必须重新组装 CanaKit 板。这些操作包括：</p>

<ul>
<li>对于 <strong>NO[1:4]</strong> 和 <strong>COM[1:4]</strong>，对顶部的蓝色接线端子进行拆焊操作，然后在底部添加公形针座。由于针座使用 200 密耳的间距，因此可以使用 3 个间距为 100 密耳但取下中间连接器的针座。</li>
<li>对于 <strong>VCC_12</strong>，对顶部的 3 脚公形针座进行拆焊操作，然后在底部安装一个新的 3 脚公形针座。舍弃跳线。</li>
<li>对于 <strong>GND</strong>，对顶部的 8 脚直角公形针座进行拆焊操作，然后在 GND 的底部将其替换为 3 个直角公形针座。</li>
<li>附加 4 个 16 毫米的公形对母形压铆螺母柱，方法是将 4 个 11 毫米的母形对母形压铆螺母柱绕到公形压铆螺母柱的一端。16 毫米的压铆螺母柱应该位于 CanaKit 板的顶部，CanaKit 板上的所有组件都已填充。</li>
</ul>

<p>对连接器进行拆焊操作以及附加公形针座引脚的位置如图 12 所示。</p>

<p><img src="/compatibility/cts/images/rack-canakit-bottom.png" alt="CanaKit UK1104 板的仰视图" width="350"/> </p>

<p><strong>图 12.</strong> CanaKit UK1104 板，进行拆焊操作（绿色）和附加公形针座（黄色）的位置（仰视图）</p>

<p>在对 VCC_12 和 GND 位置进行拆焊操作后，准备对针座引脚进行开孔处理，以便实现合适的焊锡流和连接性。使用推荐的钻头尺寸清理开孔，以便清除孔中任何多余的焊料。不要使用尺寸更大的钻头，因为此类钻头会损坏孔内的镀层。NO[1:4] 和 COM[1:4] 引脚不需要钻孔，因为这些孔适用于固定连接器上的 1 毫米接线柱，而不是 0.6 毫米针座接线柱。对于图 12 中标示为黄色的所有开孔，CanaKit 板仅在底部具有焊接掩模开孔。为了将板堆叠起来，需要将 CanaKit 板翻转一下，因此需要刮掉顶部孔周围的焊接掩模，这样才能附上合适的焊料。使用美工刀刮掉孔周围的焊接掩模，露出铜黄。</p>

<p>图 13 是板顶部电源跳线孔（焊接掩模已刮掉）的特写。最终重新组装的板如图 14 所示。</p>

<p><img src="/compatibility/cts/images/rack-closeup.png" alt="已拆除电源跳接的特写俯视图" width="150"/> </p>

<p><strong>图 13.</strong> 已拆除电源跳线（焊接掩模已刮掉）的特写俯视图</p>

<p><img src="/compatibility/cts/images/rack-reworked.png" alt="采用压铆螺母柱重新组装的板" width="350"/> </p>

<p><strong>图 14.</strong> 采用压铆螺母柱重新组装的板</p>

<p>为了方便配接 CanaKit 板和布线板，请先将公形针座引脚插入布线板上的母形针座，并在 CanaKit 板上安装所有部件，然后再将针座焊接到 CanaKit 板上。这样可以减少公形针座倾斜，而这种倾斜可能导致组装变得复杂。</p>

<p>为了确保在组装过程中正确对齐各个部件，请在 CanaKit 板上焊接公形针座，并且按照最终配置组装各个板。图 15 显示了将公形针座引脚焊接到 WIG-13118 板的位置。需要在板上执行以下操作：</p>

<ul>
<li>IN/GND 和 VCC/GND：将公形 2 脚针座焊接在底部，以便连接到布线板。</li>
<li>SIG/VCC/GND：将公形 3 脚针座焊接在顶部，以便连接到电机。</li>
</ul>

<p><img src="/compatibility/cts/images/rack-sparkfun-top-end.png" alt="SparkFun WIG-13118" width="550"/> </p>

<p><strong>图 15.</strong> (a) SparkFun WIG-13118，显示了焊接针座的位置（俯视图）；(b) 焊接到位的公形针座（概念化端视图）</p>

<h3 id="final_assembly">最终组装</h3>

<p>在进行最终组装时，用间隔条将各个板连接起来作为机械支撑。布线板应该具有 8 个 11 毫米的母形对母形压铆螺母柱，您可以用螺钉穿过布线板底部进行固定，使得 WIG-13118 板正面朝上安装。首先固定 11 毫米的压铆螺母柱，因为在将布线板安装到 CanaKit 板顶部之后，就没有足够的空间可以固定布线板底部。</p>

<p>要将布线板连接到 CanaKit 板，需要将布线板卡入 CanaKit 板，然后固定角落里的 4 个 M3 螺钉，如图 16 所示。</p>

<p><img src="/compatibility/cts/images/rack-mounted.png" alt="已安装到 CanaKit 继电器板上的布线板" width="450"/> </p>

<p><strong>图 16.</strong> 已安装到 CanaKit 继电器板上的布线板</p>

<p>卡入 SparkFun 伺服触发器使其固定到位，然后拧紧螺钉。图 17 显示了完全组装的系统。图 18 显示了已组装系统的侧视图。图 19 显示了控制器外壳的机械制图，图 20 显示了外壳内的已组装系统。</p>

<p><img src="/compatibility/cts/images/rack-assembled-top.png" alt="已组装系统的俯视图/侧视图" width="450"/> </p>

<p><strong>图 17.</strong> 已组装的系统（俯视图/正视图）</p>

<p><img src="/compatibility/cts/images/rack-assembled-side.png" alt="板堆叠侧视图" width="450"/> </p>

<p><strong>图 18.</strong> 已组装的系统（侧视图）</p>

<p><img src="/compatibility/cts/images/rack-enclosure-drawing.png" alt="控制器外壳的机械制图" width="700"/> </p>

<p><strong>图 19.</strong> 控制器外壳的机械制图</p>

<p><img src="/compatibility/cts/images/rack-enclosure.png" alt="外壳内的已组装控制器" width="450"/> </p>

<p><strong>图 20.</strong> 外壳内的已组装系统</p>

</body></html>