<html devsite><head>
    <title>支持旧版本</title>
    <meta name="project_path" value="/_project.yaml"/>
    <meta name="book_path" value="/_book.yaml"/>
  </head>
  <body>

  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p class="note"><strong>注意</strong>：这些要求仅适用于编译较低版本的 Android。对于 Android 开源项目 (AOSP) <code>master</code> 分支，请参阅标准<a href="requirements">要求</a>和<a href="initializing">构建编译环境</a>。
</p>

<h2 id="building-recent-old-releases">编译最近的旧版本（&gt;= 5.0 Lollipop）</h2>

<p>
对于 Android 5.0 版（Lollipop 或 L）到 Android 8.0 版（Oreo 或 O），请考虑使用随附的 <a href="https://android.googlesource.com/platform/build/+/master/tools/docker" class="external">Dockerfile</a>，以简化所有必需软件包的安装。</p>

<h2 id="building-really-old-releases">编译真正的旧版本（&lt;= 4.4 KitKat）</h2>

<h3 id="operating-systems">操作系统</h3>
<p>
Android 通常是在 GNU/Linux 或 Mac OS 操作系统中进行编译。您也可以使用虚拟机在不支持的系统（例如 Windows）中编译 Android。
</p>

<p>我们建议在 GNU/Linux 上进行编译。Android 编译系统通常会在编译设备上运行 ART，以预编译系统 DEX 文件。ART 只能在 Linux 上运行，因此编译系统会在非 Linux 操作系统上跳过这个预编译步骤，从而导致 Android 编译的性能下降。
</p>

<h4 id="linux">GNU/Linux</h4>
<ul>
  <li>Android 6.0 (Marshmallow) – AOSP master：Ubuntu 14.04 (Trusty)</li>
  <li>Android 2.3.x (Gingerbread) – Android 5.x (Lollipop)：Ubuntu 12.04 (Precise)</li>
  <li>Android 1.5 (Cupcake) – Android 2.2.x (Froyo)：Ubuntu 10.04 (Lucid)</li>
</ul>
<h4 id="mac">Mac OS X (Intel/x86)</h4>
<ul>
  <li>Android 6.0 (Marshmallow) – AOSP master：Mac OS X v10.10 (Yosemite) 或更高版本，具有 Xcode 4.5.2 和命令行工具</li>
  <li>Android 5.x (Lollipop)：Mac OS X v10.8 (Mountain Lion)，具有 Xcode 4.5.2 和命令行工具</li>
  <li>Android 4.1.x (Jelly Bean) – Android 4.4.x (KitKat)：Mac OS X v10.6 (Snow Leopard) 或 Mac OS X v10.7 (Lion)，以及 Xcode 4.2（Apple 开发者工具）</li>
  <li>Android 1.5 (Cupcake) – Android 4.0.x (Ice Cream Sandwich)：Mac OS X v10.5 (Leopard) 或 Mac OS X v10.6 (Snow Leopard)，以及 Mac OS X v10.5 SDK</li>
</ul>

<h3 id="make">GNU make</h3>

<p>
对于早于 AOSP master 分支的版本（一直到 Android 4.1.x (Jelly Bean)），请使用 <a href="http://ftp.gnu.org/gnu/make/" class="external">GNU make (gmake) 3.82</a>。对于 Android 4.0.x (Ice Cream Sandwich) 及更低版本，请<a href="#reverting-from-make-382">从 gmake 3.82 还原到旧版本</a>，以避免出现编译错误。
</p>

<h4 id="xcode-other-packages">Xcode 和其他软件包</h4>
<p>
对于较低版本的 Mac OS X v10.8 或更低版本，请从 <a href="http://developer.apple.com/" class="external">Apple 开发者网站</a>安装 Xcode。如果您尚未注册成为 Apple 开发者，则必须创建一个 Apple ID 才能下载。
</p>
<p>
如果您使用的是 Mac OS X v10.4，还需要安装 bison：
    </p><pre class="devsite-terminal devsite-click-to-copy">
    POSIXLY_CORRECT=1 sudo port install bison</pre>
<p></p>

<p>
如果使用的是 MacPorts，请发出：
    </p><pre class="devsite-terminal devsite-click-to-copy">
    POSIXLY_CORRECT=1 sudo port install gmake libsdl git gnupg</pre>
<p></p>

<p>
如果使用的是 Homebrew，请发出：
    </p><pre class="devsite-terminal devsite-click-to-copy">
    brew install gmake libsdl git gnupg2</pre>
<p></p>

<h4 id="reverting-from-make-382">从 gmake 3.82 还原到旧版本</h4>
<p>
在 Android 4.0.x (Ice Cream Sandwich) 及更低版本中，gmake 3.82 中存在一个会导致 Android 无法编译的错误。您可以按照以下步骤使用 MacPorts 来安装 3.81 版：
</p>
<ol>
  <li>修改 <code>/opt/local/etc/macports/sources.conf</code>，并在 rsync 行上方添加以下行：<pre class="devsite-click-to-copy">
    file:///Users/Shared/dports</pre>
然后创建该目录：
    <pre class="devsite-terminal devsite-click-to-copy">
    mkdir /Users/Shared/dports</pre>
  </li>
  <li>在新的 <code>dports</code> 目录下，运行以下命令：
    <pre class="devsite-terminal devsite-click-to-copy">
    svn co --revision 50980 http://svn.macports.org/repository/macports/trunk/dports/devel/gmake/ devel/gmake/</pre>
  </li>
  <li>为新的本地代码库创建一个端口索引：
    <pre class="devsite-terminal devsite-click-to-copy">
    portindex /Users/Shared/dports</pre>
  </li>
  <li>安装旧版 gmake：<pre class="devsite-terminal devsite-click-to-copy">
    sudo port install gmake @3.81</pre>
  </li>
</ol>

<h3 id="jdk">JDK</h3>
<h4 id="supported-versions">支持的版本</h4>

<ul>
<li>Android 7.0 (Nougat) – Android 8.0 (Oreo)：<ul>
    <li>Ubuntu：<a href="http://openjdk.java.net/install/" class="external">OpenJDK 8</a></li>
    <li>Mac OS X：<a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html#jdk-8u45-oth-JPR" class="external">JDK 8u45 或更高版本</a></li>
    </ul>
  </li>
<li>Android 5.x (Lollipop) – Android 6.0 (Marshmallow)：<ul>
      <li>Ubuntu：<a href="http://openjdk.java.net/install/" class="external">OpenJDK 7</a></li>
    <li>Mac OS X：<a href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html#jdk-7u71-oth-JPR" class="external">jdk-7u71-macosx-x64.dmg</a></li>
    </ul>
  </li>
<li>Android 2.3.x (Gingerbread) – Android 4.4.x (KitKat)：<ul>
      <li>Ubuntu：<a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" class="external">Java JDK 6</a></li>
        <li>Mac OS X：<a href="http://support.apple.com/kb/dl1572" class="external">Java JDK 6</a></li>
    </ul>
  </li>
<li>Android 1.5 (Cupcake) – Android 2.2.x (Froyo)：<ul>
    <li>Ubuntu：<a href="http://www.oracle.com/technetwork/java/javase/archive-139210.html" class="external">Java JDK 5</a></li>
    </ul>
  </li>
</ul>

<h4 id="jdk-linux">适用于 Linux 的 JDK</h4>

<p>
<a href="https://android.googlesource.com/" class="external">Android 开源项目 (AOSP)</a> 中 Android 的 <code>master</code> 分支在 <code>prebuilts/jdk/</code> 下有预编译版本的 OpenJDK，因此无需另行安装。
</p>
<p>
较低版本的 Android 需要单独安装 JDK。在 Ubuntu 上，请使用 <a href="http://openjdk.java.net/install/" class="external">OpenJDK</a>。</p>
<h4 id="for-ubuntu-15-04">如果 Ubuntu &gt;= 15.04</h4>
<p>
请运行以下命令：
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">sudo apt-get update</code>
<code class="devsite-terminal">sudo apt-get install openjdk-8-jdk</code>
</pre>

<h4 id="for-ubuntu-14-04">如果是 Ubuntu LTS 14.04</h4>
<p>
目前没有适用于 Ubuntu 14.04 的受支持 OpenJDK 8 软件包。<strong>Ubuntu 15.04 OpenJDK 8</strong> 软件包能够在 Ubuntu 14.04 中顺利使用。<em>更高的软件包版本（例如适用于 15.10、16.04 的版本）在 14.04 上使用以下指令时不起作用。</em>
</p>
<ol>
  <li>从 <a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/" class="external">old-releases.ubuntu.com</a> 下载适用于 64 位架构的 <code>.deb</code> 软件包：<ul>
      <li><a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre-headless_8u45-b14-1_amd64.deb" class="external">openjdk-8-jre-headless_8u45-b14-1_amd64.deb</a> (SHA256 <code>0f5aba8db39088283b51e00054813063173a4d8809f70033976f83e214ab56c0</code>)
      </li>
      <li><a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jre_8u45-b14-1_amd64.deb" class="external">openjdk-8-jre_8u45-b14-1_amd64.deb</a> (SHA256 <code>9ef76c4562d39432b69baf6c18f199707c5c56a5b4566847df908b7d74e15849</code>)
      </li>
      <li><a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/o/openjdk-8/openjdk-8-jdk_8u45-b14-1_amd64.deb" class="external">openjdk-8-jdk_8u45-b14-1_amd64.deb</a> (SHA256 <code>6e47215cf6205aa829e6a0a64985075bd29d1f428a4006a80c9db371c2fc3c4c</code>)
      </li>
    </ul>
  </li>
  <li>（可选）对照随以上每个软件包列出的 SHA256 字符串，确认已下载文件的校验和。例如，使用 <code>sha256sum</code> 工具：
    <pre class="devsite-terminal devsite-click-to-copy">
    sha256sum {downloaded.deb file}</pre>
  </li>
  <li>安装软件包：
    <pre class="devsite-terminal devsite-click-to-copy">
    sudo apt-get update</pre>
为下载的每个 <code>.deb</code> 文件运行 <code>dpkg</code>。运行过程中可能会因缺少依赖项而出现错误：
    <pre class="devsite-terminal devsite-click-to-copy">
    sudo dpkg -i {downloaded.deb file}</pre>
解决缺少依赖项的问题：
    <pre class="devsite-terminal devsite-click-to-copy">
    sudo apt-get -f install</pre>
  </li>
</ol>

<h4 id="default-java-version"><em></em>（可选）更新默认的 Java 版本</h4>
<p>
（可选）对于以上 Ubuntu 版本，请通过运行以下命令来更新默认的 Java 版本：
</p>
<pre class="devsite-click-to-copy">
<code class="devsite-terminal">sudo update-alternatives --config java</code>
<code class="devsite-terminal">sudo update-alternatives --config javac</code>
</pre>
<aside class="note">
  <b>注意</b>：在编译过程中，如果您遇到 Java 版本错误，请参阅<a href="/setup/build/building#wrong-java-version">错误的 Java 版本</a>以查找可能的原因和解决方案。
 </aside>

</body></html>