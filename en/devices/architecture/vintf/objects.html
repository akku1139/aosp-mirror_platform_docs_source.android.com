<html devsite>
  <head>
    <title>Manifests</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  {% include "_versions.html" %}
  <body>
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>A VINTF object aggregates data from <a href="#device-manifest-file">device
manifest</a> and <a href="#framework-manifest-file">framework manifest</a> files
(XML) and from the device itself at <a href="#runtime-data">runtime</a>. Both
manifests share a format, although not all elements apply to both (for details
on the schema, see <a href="#manifest-file-schema">Manifest file schema</a>).
</p>

<h2 id="device-manifest-file">Device manifest</h2>
<p>The device manifest (provided by the device) consists of the vendor manifest
and the ODM manifest.</p>

<ul>
<li>The vendor manifest specifies HALs, VNDK versions, etc. common to an SoC. It
is recommended to be placed in the Android source tree at
<code>device/<var>VENDOR</var>/<var>DEVICE</var>/manifest.xml</code>, but multiple fragment
files can be used. For details, see
<a href="/devices/architecture/vintf/resources#manifest-fragments">Generate
DM from fragments</a>.
</li>
<li>The ODM manifest lists HALs specific to the product. The VINTF object loads the ODM
  manifest in this order:
  <ol>
    <li>If <code><var>SKU</var></code> is defined (where <code><var>SKU</var></code> is the value of
      the property <code>ro.boot.product.hardware.sku</code>),
      <code>/odm/etc/vintf/manifest_<var>SKU</var>.xml</code>
    </li>
    <li><code>/odm/etc/vintf/manifest.xml</code></li>
    <li>If <code><var>SKU</var></code> is defined,
      <code>/odm/etc/manifest_<var>SKU</var>.xml</code></li>
    <li><code>/odm/etc/manifest.xml</code></li>
  </ol>
</li>
<li>The VINTF object loads the device manifest in this order:
  <ol>
    <li>If <code>/vendor/etc/vintf/manifest.xml</code> exists, combine the following:
      <ol>
        <li><code>/vendor/etc/vintf/manifest.xml</code></li>
        <li>Optional vendor manifest fragments</li>
        <li>Optional ODM manifest
        <li>Optional ODM manifest fragments</li>
      </ol>
    <li>Otherwise, if the ODM manifest exists, combine the ODM manifest with the optional ODM
      manifest fragments.</li>
    <li><code>/vendor/manifest.xml</code> (legacy, no fragments)</li>
  </ol>
  <p>
  Note that:
  </p>
  <ul>
    <li>On legacy devices, the legacy vendor manifest and the ODM manifest are used. The
      ODM manifest may completely override the legacy vendor manifest.</li>
    <li>On devices launched with Android {{ androidPVersionNumber }}, the ODM manifest is combined
      with the vendor manifest.</li>
    <li>When combining a list of manifests, manifests that appear later in the list may override
      tags in manifests that appear earlier in the list, provided that the tags in the later
      manifest have the attribute <code>override="true"</code>. For example, the ODM manifest may
      override some <code>&lt;hal></code> tags from the vendor manifest. See the documentation for
      attribute <code>override</code> below.</li>
  </ul>
</li>
</ul>

<p>This setup enables multiple products with the same board to share the same
vendor image (which provides common HALs) yet have different ODM images (which
specify product-specific HALs).</p>

<p>Here's an example vendor manifest.</p>

<pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!-- Comments, Legal notices, etc. here -->
&lt;manifest version="1.0" type="device" target-level="1">
    &lt;hal>
        &lt;name>android.hardware.camera&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>3.4&lt;/version>
        &lt;interface>
            &lt;name>ICameraProvider&lt;/name>
            &lt;instance>legacy/0&lt;/instance>
            &lt;instance>proprietary/0&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hardware.nfc&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;version>2.0&lt;/version>
        &lt;interface>
            &lt;name>INfc&lt;/name>
            &lt;instance>nfc_nci&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hardware.nfc&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>2.0&lt;/version>
        &lt;interface>
            &lt;name>INfc&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hardware.drm&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>ICryptoFactory&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
        &lt;interface>
            &lt;name>IDrmFactory&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
        &lt;fqname>@1.1::ICryptoFactory/clearkey&lt;/fqname>
        &lt;fqname>@1.1::IDrmFactory/clearkey&lt;/fqname>
    &lt;/hal>
    &lt;hal format="native">
        &lt;name>EGL&lt;/name>
        &lt;version>1.1&lt;/version>
    &lt;/hal>
    &lt;hal format="native">
        &lt;name>GLES&lt;/name>
        &lt;version>1.1&lt;/version>
        &lt;version>2.0&lt;/version>
        &lt;version>3.0&lt;/version>
    &lt;/hal>
    &lt;sepolicy>
        &lt;version>25.0&lt;/version>
    &lt;/sepolicy>
&lt;/manifest>
</pre>

<p>Here's an example ODM manifest.</p>

<pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!-- Comments, Legal notices, etc. here -->
&lt;manifest version="1.0" type="device">
    &lt;!-- camera 3.4 in vendor manifest is ignored -->
    &lt;hal override="true">
        &lt;name>android.hardware.camera&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>3.5&lt;/version>
        &lt;interface>
            &lt;name>ICameraProvider&lt;/name>
            &lt;instance>legacy/0&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;!-- NFC is declared to be disabled -->
    &lt;hal override="true">
        &lt;name>android.hardware.nfc&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hardware.power&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.1&lt;/version>
        &lt;interface>
            &lt;name>IPower&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
    &lt;/hal>
&lt;/manifest>
</pre>

<p>Here's an example device manifest in an OTA package.</p>
<pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!-- Comments, Legal notices, etc. here -->
&lt;manifest version="1.0" type="device" target-level="1">
    &lt;!-- hals ommited -->
    &lt;kernel version="4.4.176">
        &lt;config>
            &lt;key>CONFIG_ANDROID&lt;/key>
            &lt;value>y&lt;/value>
        &lt;/config>
        &lt;config>
            &lt;key>CONFIG_ARM64&lt;/key>
            &lt;value>y&lt;/value>
        &lt;/config>
    &lt;!-- other configs ommited -->
    &lt;/kernel>
&lt;/manifest>
</pre>

<p>For more details, see <a href="/devices/architecture/vintf/dm">Device Manifest
  Development</a>.</p>

<h2 id="framework-manifest-file">Framework manifest</h2>
<p>The framework manifest file (provided by Google) is manually generated and
lives in the Android source tree at
<code><a href="https://android.googlesource.com/platform/system/libhidl/+/refs/heads/master/vintfdata/manifest.xml"
         class="external">/system/libhidl/manifest.xml</a></code>.
</p>

<p>Here's an example framework manifest.</p>

<pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!-- Comments, Legal notices, etc. here -->
&lt;manifest version="1.0" type="framework">
    &lt;hal>
        &lt;name>android.hidl.allocator&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>IAllocator&lt;/name>
            &lt;instance>ashmem&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hidl.memory&lt;/name>
        &lt;transport arch="32+64">passthrough&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>IMapper&lt;/name>
            &lt;instance>ashmem&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.hidl.manager&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>IServiceManager&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;hal>
        &lt;name>android.frameworks.sensorservice&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>ISensorManager&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
    &lt;/hal>
    &lt;vendor-ndk>
        &lt;version>27&lt;/version>
    &lt;/vendor-ndk>
    &lt;system-sdk>
        &lt;version>27&lt;/version>
    &lt;/system-sdk>
&lt;/manifest>
</pre>

<h2 id="manifest-fragments">Manifest fragments</h2>

<p>
  In Android 10 and higher, you can associate a manifest
  entry with a HAL module in the build system. This makes it easier to
  conditionally include the HAL module in the build system.
</p>

<h3 id="manifest-fragment-example">Example</h3>

  <p>
    In your <code>Android.bp</code> or <code>Android.mk</code> file, add
    <code>vintf_fragments</code> to any module. For example, you can modify
    the module with your implementation of your HAL
    (<code>my.package.foo@1.0-service-bar</code>).
  </p>


<pre class="prettyprint">... {
    ...
    vintf_fragments: ["manifest_foo.xml"],
    ...
}</pre>


<pre class="prettyprint">LOCAL_MODULE := ...
LOCAL_VINTF_FRAGMENTS := manifest_foo.xml</pre>

  <p>
    In a file called <code>manifest_foo.xml</code>, create the manifest for
    this module. At build time, this manifest is added to the device. Adding
    an entry here is the same as adding an entry in the device's main manifest.
    This allows clients to use the interface and allows VTS to identify which HAL
    implementations are on the device. Anything that a regular manifest
    does, this manifest also does.
  </p>

  <p>
    The example below implements
    <code>android.hardware.foo@1.0::IFoo/default</code>, which is installed to
    the <code>vendor</code> partition. If it's installed to the
    <code>system</code> partition, use type <code>framework</code> instead of
    type <code>device</code>.
  </p>


<pre class="prettyprint">&lt;manifest version="1.0" type="device">
    &lt;hal format="hidl">
        &lt;name>android.hardware.foo&lt;/name>
        &lt;transport>hwbinder&lt;/transport>
        &lt;version>1.0&lt;/version>
        &lt;interface>
            &lt;name>IFoo&lt;/name>
            &lt;instance>default&lt;/instance>
        &lt;/interface>
    &lt;/hal>
&lt;/manifest></pre>

<h2 id="manifest-file-schema">Manifest file schema</h2>
<p>This section describes the meaning of these XML tags. Some "required" tags
can be missing from the source file in Android source tree and written by
<code><a href="/devices/architecture/vintf/resources#assemble_vintf">assemble_vintf</a></code>
at build time. Required tags must be present in the corresponding files on the
device.</p>

<dl>
<dt><code>?xml</code></dt>
<dd>Optional. Only provides information to the XML parser.</dd>
<dt><code>manifest.version</code></dt>
<dd>Required. Meta-version of <strong>this</strong> manifest. Describes the
elements expected in the manifest. Unrelated to XML version.</dd>
<dt><code>manifest.type</code></dt>
<dd>Required. Type of this manifest. It has the value <code>device</code> for
the device manifest file and <code>framework</code> for the framework manifest
file.</dd>
<dt><code>manifest.target-level</code></dt>
<dd>Required for the device manifest. Specifies the framework compatibility matrix
(FCM) version that this device manifest is targeted to be compatible
with. This is also called the shipping FCM version of the device.</dd>
<dt><code>manifest.hal</code></dt>
<dd>Optional, can repeat. A single HAL (HIDL or native, such as GL),
depending on the <code>format</code> attribute.</dd>
<dt><code>manifest.hal.format</code></dt>
<dd>Optional. The value can be one of:
 <ul>
 <li><code>hidl</code>: HIDL HALs. This is the default.
 <li><code>native</code>: Native HALs.</li>
 </ul>
</dd>
<dt><code>manifest.hal.override</code></dt>
<dd>Optional. The value can be one of:
 <ul>
 <li><code>true</code>: Override other <code>&lt;hal></code> elements with
  the same <code>&lt;name></code> and major version. If no
  <code>&lt;version></code> or <code>&lt;fqname></code> are in this
  <code>&lt;hal></code> element, then the <code>&lt;hal></code> element
   declares this HAL to be disabled.</li>
 <li><code>false</code>: Don't override other <code>&lt;hal></code> elements
  with the same <code>&lt;name></code> and major version.</li>
 </ul>
</dd>
<dt><code>manifest.hal.name</code></dt>
<dd>Required. Fully qualified package name of the HAL. Multiple HAL entries can use
the same name. Examples:
 <ul>
 <li><code>android.hardware.camera</code> (HIDL HAL)</li>
 <li><code>GLES</code> (native HAL, requires name only)</li>
 </ul>
 </dd>
<dt><code>manifest.hal.transport</code></dt>
<dd>Required when <code>manifest.hal.format == "hidl"</code>. Must NOT be
present otherwise. States what transport is used when an interface from
this package is queried from the service manager. The value can be one of:
 <ul>
 <li><code>hwbinder</code>: Binderized mode</li>
 <li><code>passthrough</code>: Passthrough mode</li>
 </ul>
</dd>
<dt><code>manifest.hal.transport.arch</code></dt>
<dd>Required for <code>passthrough</code> and must not be present for
<code>hwbinder</code>. Describes the bitness of the passthrough service being
provided. The value can be one of:
 <ul>
 <li><code>32</code>: 32-bit mode</li>
 <li><code>64</code>: 64-bit mode</li>
 <li><code>32+64</code>: Both</li>
 </ul>
</dd>
<dt><code>manifest.hal.version</code></dt>
<dd>Optional, can repeat. A version for the <code>hal</code> tags in a
manifest. The format is <code><var>MAJOR</var>.<var>MINOR</var></code>. For
examples, refer to <code>hardware/interfaces</code>,
<code>vendor/${VENDOR}/interfaces</code>,
<code>framework/hardware/interfaces</code>, or<code>
system/hardware/interfaces</code>.
<br><br>
HIDL and native HALs may use multiple version fields as long as they represent
<strong>distinct major versions</strong>, with only one minor version per major
version provided. For example, 3.1 and 3.2 can't coexist, but 1.0 and 3.4 can.
This applies to all <code>hal</code> elements with the same name, unless
<code>override="true"</code>.</dd>
<dt><code>manifest.hal.interface</code></dt>
<dd>Required, can repeat without duplicates. State an interface in the
package that has an instance name. There can be multiple
<code>&lt;interface&gt;</code> elements in a <code>&lt;hal&gt;</code>; names
must be distinct.</dd>
<dt><code>manifest.hal.interface.name</code></dt>
<dd>Required. Name of the interface.</dd>
<dt><code>manifest.hal.interface.instance</code></dt>
<dd>Required, can repeat. Instance name of the interface. Can have multiple
instances for an interface but no duplicated <code>&lt;instance&gt;</code>
elements.</dd>
<dt><code>manifest.hal.fqname</code></dt>
<dd>Optional, can repeat. An alternative way to specify an instance for the HAL
with name <code>manifest.hal.name</code>. The format is
<code>@<var>MAJOR</var>.<var>MINOR</var>::<var>INTERFACE</var>/<var>INSTANCE</var></code>.
For devices upgrading from Android 8.x, this can't be used to declare
instances required by the compatibility matrix.</dd>
<dt><code>manifest.sepolicy</code></dt>
<dd>Required. Contains all sepolicy-related entries.</dd>
<dt><code>manifest.sepolicy.version</code></dt>
<dd>Required for the device manifest. Declares the SELinux version. It has the
format <code><var>SDK_INT</var>.<var>PLAT_INT</var></code>.</dd>
<dt><code>manifest.vendor-ndk</code></dt>
<dd>Required, can repeat; required for the framework manifest. Must not be present
in the device manifest. Multiple <code>&lt;vendor-ndk></code> entries must have
different <code>&lt;version></code>s. Describes a set of VNDK snapshots
provided by the framework.</dd>
<dt><code>manifest.vendor-ndk.version</code></dt>
<dd>Required. This is a positive integer representing the version of the VNDK
snapshot.</dd>

<dt><code>manifest.vendor-ndk.library</code></dt>
<dd>Optional, can repeat, without duplicates. Describes a set of VNDK libraries
provided by the framework for this VNDK vendor snapshot. The value is the
filename of a library, e.g. <code>libjpeg.so</code>, including the prefix
<code>lib</code> and the suffix <code>.so</code>. No path components are
allowed.</dd>
<dt><code>manifest.system-sdk.version</code></dt>
<dd>Optional, can repeat, without duplicates; used only by the framework
manifest. Describes a set of system SDK versions provided by the framework to
vendor apps.</dd>
<dt><code>manifest.kernel</code></dt>
<dd>Optional. Only present in the device manifest in the OTA package metadata.
Describes information about the kernel in the OTA package. This information is
not present in the device manifest on a running device because the VINTF object
extracts kernel information from the kernel interfaces instead. See
<a href="/devices/architecture/vintf/dm#ota-kernel-q">Mandating kernel
requirements during OTA</a> for details.</dd>
<dt><code>manifest.kernel.version</code></dt>
<dd>Required attribute if <code>&lt;kernel></code> is present. Describes the
version of the kernel in the OTA package.</dd>
<dt><code>manifest.kernel.config</code></dt>
<dd>Optional, can repeat, without duplicates. Describes a configuration of the
kernel in the OTA package.</dd>
<dt><code>manifest.kernel.config.key</code></dt>
<dd>Required if <code>&lt;config></code> is present. Describes the key of the
  configuration.</dd>
<dt><code>manifest.kernel.config.value</code></dt>
<dd>Required if <code>&lt;config></code> is present. Describes the value of the
  configuration.</dd>
</dl>

  </body>
</html>

