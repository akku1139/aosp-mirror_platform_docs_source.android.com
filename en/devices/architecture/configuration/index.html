<html devsite>
  <head>
    <title>Configuring</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  <body>
{% include "_versions.html" %}
  <!--
      Copyright 2019 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>
  Android {{ androidQVersionNumber }} deprecates the ConfigStore HAL due to high
  memory consumption and difficult usage, and replaces the HAL with system
  properties. In Android {{ androidQVersionNumber }}:
</p>

<ul>
  <li>ConfigStore uses build flags to store config values in the vendor
  partition, and a service in the system partition accesses those values using
  HIDL (this is also true in Android 9).
  <li>System properties use <code>PRODUCT_DEFAULT_PROPERTY_OVERRIDES</code> to
  store system properties in <code>default.prop</code> in the vendor partition,
  and the service uses <code>sysprop</code> to read those properties.</li>
</ul>

<p>
  The ConfigStore HAL remains in AOSP to support legacy vendor partitions. On
  devices running Android {{ androidQVersionNumber }},
  <code>surfaceflinger</code> reads system properties first; if no system
  property is defined for a config item in
  <code>SurfaceFlingerProperties.sysprop</code>, <code>surfaceflinger</code>
  falls back to the ConfigStore HAL.
</p>

<h2 id="build-flags-and-system-properties">Build flags and system
 properties</h2>

<p>
  Each build flag in ConfigStore has a matching system property, as shown in the
  following table.
</p>

<table>
  <tr>
   <th>Build flags</th>
   <th>System properties</th>
  </tr>
  <tr>
  <td><code>TARGET_FORCE_HWC_FOR_VIRTUAL_DISPLAYS</code>
   </td>
   <td><code>ro.surface_flinger.force_hwc_copy_for_virtual_displays</code>
   </td>
  </tr>
  <tr>
  <td><code>TARGET_HAS_HDR_DISPLAY</code>
   </td>
   <td><code>ro.surface_flinger.has_HDR_display</code>
   </td>
  </tr>
  <tr>
   <td><code>TARGET_HAS_WIDE_COLOR_DISPLAY</code>
   </td>
   <td><code>ro.surface_flinger.has_wide_color_display</code>
   </td>
  </tr>
  <tr>
   <td><code>NUM_FRAMEBUFFER_SURFACE_BUFFERS</code>
   </td>
   <td><code>ro.surface_flinger.max_frame_buffer_acquired_buffers</code>
   </td>
  </tr>
  <tr>
   <td><code>MAX_VIRTUAL_DISPLAY_DIMENSION</code>
   </td>
   <td><code>ro.surface_flinger.max_virtual_display_dimension</code>
   </td>
  </tr>
  <tr>
   <td><code>PRIMARY_DISPLAY_ORIENTATION</code>
   </td>
   <td><code>ro.surface_flinger.primary_display_orientation</code>
   </td>
  </tr>
  <tr>
   <td><code>PRESENT_TIME_OFFSET_FROM_VSYNC_NS</code>
   </td>
   <td><code>ro.surface_flinger.present_time_offset_from_vsync_ns</code>
   </td>
  </tr>
  <tr>
   <td><code>TARGET_RUNNING_WITHOUT_SYNC_FRAMEWORK</code>
   </td>
   <td><code>ro.surface_flinger.running_without_sync_framework</code>
   </td>
  </tr>
  <tr>
   <td><code>SF_START_GRAPHICS_ALLOCATOR_SERVICE</code>
   </td>
   <td><code>ro.surface_flinger.start_graphics_allocator_service</code>
   </td>
  </tr>
  <tr>
   <td><code>TARGET_USE_CONTEXT_PRIORITY</code>
   </td>
   <td><code>ro.surface_flinger.use_context_priority</code>
   </td>
  </tr>
  <tr>
   <td><code>USE_VR_FLINGER</code>
   </td>
   <td><code>ro.surface_flinger.use_vr_flinger</code>
   </td>
  </tr>
  <tr>
   <td><code>VSYNC_EVENT_PHASE_OFFSET_NS</code>
   </td>
   <td><code>ro.surface_flinger.vsync_event_phase_offset_ns</code>
   </td>
  </tr>
  <tr>
   <td><code>SF_VSYNC_EVENT_PHASE_OFFSET_NS</code>
   </td>
   <td><code>ro.surface_flinger.vsync_sf_event_phase_offset_ns</code>
   </td>
  </tr>
</table>

<h2 id="new-system-properties">New system properties</h2>

<p>
  Android {{ androidQVersionNumber }} includes the following new system
  properties:
</p>

<ul>
<li><code>ro.surface_flinger.default_composition_dataspace</code>
  <li><code>ro.surface_flinger.default_composition_pixel_format</code>
  <li><code>ro.surface_flinger.use_color_management</code>
  <li><code>ro.surface_flinger.wcg_composition_dataspace</code>
  <li><code>ro.surface_flinger.wcg_composition_pixel_format</code>
  <li><code>ro.surface_flinger.display_primary_red</code>
  <li><code>ro.surface_flinger.display_primary_green</code>
  <li><code>ro.surface_flinger.display_primary_blue</code>
  <li><code>ro.surface_flinger.display_primary_white</code>
  <li><code>ro.surface_flinger.protected_contents</code>
  <li><code>ro.surface_flinger.set_idle_timer_ms</code>
  <li><code>ro.surface_flinger.set_touch_timer_ms</code>
  <li><code>ro.surface_flinger.use_smart_90_for_video</code>
  <li><code>ro.surface_flinger.protected_contents</code>
  <li><code>ro.surface_flinger.support_kernel_idle_timer</code></li>
</ul>

<p>
  For details on these properties, refer to
  <code>frameworks/native/services/surfaceflinger/sysprop/SurfaceFlingerProperties.sysprop</code>.
</p>

<h2 id="using-surfaceflingerproperties">Using SurfaceFlingerProperties</h2>
<p>
  In the following examples for the SurfaceFlingerProperties library, the
  function name is <code>api_name</code> in
  <code>SurfaceFlingerProperties.sysprop</code>.
</p>

<pre class="prettyprint">cc_binary {
    name: "cc_client",
    srcs: ["baz.cpp"],
    shared_libs: ["SurfaceFlingerProperties"],
}
java_library {
    name: "JavaClient",
    srcs: ["foo/bar.java"],
    libs: ["SurfaceFlingerProperties"],
}</pre>

<pre class="prettyprint">import android.sysprop.SurfaceFlingerProperties;
...

static void foo() {
    ...
    boolean temp = SurfaceFlingerProperties.vsync_event_phase_offset_ns().orElse(true);
    ...
}
...</pre>

<pre class="prettyprint">#include &lt;SurfaceFlingerProperties.sysprop.h>
using namespace android::sysprop;

...

void bar() {
    ...
    bool temp = SurfaceFlingerProperties::vsync_event_phase_offset_ns(true);
    ...
}
...</pre>


  </body>
</html>
