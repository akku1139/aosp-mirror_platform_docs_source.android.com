<html devsite>
  <head>
    <title>Activity Launch Policy</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  <body>
{% include "_versions.html" %}

  <!--
      Copyright 2019 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->


<p><em>Activity launch behavior</em> is defined by launch modes in the
<code>AndroidManifest.xml</code> files of apps, intent flags, and ActivityOptions
provided by the caller. Use <code>ActivityOption#setLaunchDisplayId(int)</code> to
target a specific display for activity launch.</p>

<ul>
<li>By default, the activity launches on the same display as the caller.
For example, a new instance of an activity started from the launcher should be
placed on the same display without additional flags or options. Be sure to use the
correct context (Activity versus Application) for launch.</li>

<li>If the launch is performed from a source not associated with a specific display
(such as from a shell or Application context), then the activity is placed on the top display
on which the user last interacted with the device or from which the last activity was
launched.</li>

<li>Intent to launch an activity can be resolved to an existing activity
instance in the system. In such a case, if no additional flags were provided, an
activity surfaces on the same display where it was last used. If the target display
is specified with <code>ActivityOptions#setTargetDisplayId()</code>, then the
activity is moved to that display (if allowed by security and other restrictions).</li>
</ul>

<h2 id="security">Security restrictions</h2>

<p>To prevent a malicious app from misappropriating user-sensitive information
by reading it from the surface of a virtual display that it has created, apps can
launch their own activities <em>only</em> on a virtual display of their creation
in Android {{ androidQVersionNumber }}. However:</p>

<ul>
<li>System components with the <code>INTERNAL_SYSTEM_WINDOW</code>
permission can launch on any display</li>
<li>Callers with the <code>ACTIVITY_EMBEDDING</code> permission can launch
activities from other apps that have the flag <code>ActivityInfo.FLAG_ALLOW_EMBEDDED</code></li>
<li>Activity launches on private displays are allowed only for the owner or
activities present on that display</li>
</ul>

<p>Similar restrictions apply to adding windows to displays.</p>

<p>Android {{ androidQVersionNumber }} includes the
<code>ActivityManager#isActivityStartAllowedOnDisplay(Context context, int
displayId, Intent intent)</code> method to check security restrictions for the
app before attempting to launch on a display. In Android 9 (and lower), restricted
launch results throw <code>SecurityException</code>.</p>

<p>Most security restrictions are applied in the
<code>ActivityStackSupervisor#isCallerAllowedToLaunchOnDisplay()</code> method.</p>


  </body>
</html>
