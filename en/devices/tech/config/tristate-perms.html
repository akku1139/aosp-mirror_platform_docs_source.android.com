<html devsite>
  <head>
    <title>Tristate Location Permissions</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  {% include "_versions.html" %}
  <body>
  <!--
      Copyright 2019 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>Tristate location permissions in Android {{ androidQVersionNumber }} give users more control over
how apps access their device locations.</p>

<p>In Android 9 and lower, users made persistent choices when granting location access to apps. They
could either <strong>Deny</strong> or <strong>Allow</strong>, the latter of which gave apps access
all the time (foreground and background). Tristate location permissions in Android {{
androidQVersionNumber }} give users three options for allowing an app access to a device’s location.
Users are prompted to grant or deny the permission level when an app requests it.</p>

<p>A user normally sees the three choices presented in Figure 1. However, there are use cases where only
  two of these options are required, and in such cases only those two are shown.</p>

<figure id="tristate-screen">
<img src="images/tristate-image.png" width="250" alt="Tristate location permissions screen" title="User selects one of these choices">
  <figcaption><strong>Figure 1.</strong> Tristate notifications screen</figcaption></figure>

<p>These are the three options:</p>

<ul>
<li><strong> Allow all the time</strong>: the device’s location is known to the app even when
the app is not in use (running in the background). This is equivalent to allowing permission in
Android 9 and lower.</li>
<li><strong>Allow only while the app is in use</strong>: (foreground only)
the device’s location is only visible to the app when it’s actively running.</li>
<li><strong>Deny</strong>: the device’s location is never visible to the app. This is the same as
denying permission in Android 9 and lower.</li>
</ul>

<p>Users are prompted to grant location access permission when apps request the
permission.</p>

<p>Once a user grants <strong>Allow only while the app is in use</strong> access permission, an app
can request an incremental increase in access to <strong>Allow all the time</strong>. The user sees
a request dialog (shown in <a href="#incremental-permissions-screens">Figure 2</a>). If the user
selects <strong>Keep while-in-use access</strong>, when the app accesses device location on next
use, the dialog provides the option to <strong>Keep and don't ask again</strong>.</p>

<p>The dialog appears under these conditions for apps targeting Android {{ androidQVersionNumber }}:</p>

<ul>
<li>After at least 24 hours of granting the permission.</li>
<li>Only if the app is receiving locations in the background.</li>
<li>When the screen is on, and the user is not utilizing another app.</li>
</ul>

<figure id="incremental-permissions-screens">
<img src="images/incremental-permissions-screen.png" width="600" alt="Incremental permissions" title="Incremental permissions for user">
  <figcaption><strong>Figure 2.</strong> Incremental permissions</figcaption></figure>

<p>To learn more about requesting permissions, see <a href =
"https://developer.android.com/preview/privacy/device-location" class = "external">App access to
device location</a>. For details if your app targets Android 9 and lower, see <a href
="https://developer.android.com/preview/privacy/device-location#continuation-user-initiated-action"
class ="external">Continuation of user-initiated action</a>.</p>

<h2 id="impact">Impact</h2>

<p> The tristate location permissions feature affects any app that needs device location access
while running in the background, and is required in Android {{ androidQVersionNumber }}.</p>

<p>You may change your code but you <em>may not</em> alter or customize
permission-related behavior in the framework.</p>

<h2 id="implementation">Implementation</h2>

<p>Tristate location permissions are applied to apps in Android {{ androidQVersionNumber }}
  irrespective of an app’s target SDK.</p>

<p>For information on implementing your app's use cases (on upgrades), refer to the <a href=
"https://developer.android.com/preview/privacy/device-location#device-upgrade" class
="external">Design for device upgrade scenarios</a> section in the developer documentation.</p>

<p>To see how to enable access for different use cases (such as requiring background location
access for apps like Google Maps or Google Play services), view these topics on the <a
href="https://developer.android.com/preview/privacy/device-location" class="external">App access to
device location</a> page:</p>

<ul>
<li><a href="https://developer.android.com/preview/privacy/device-location#request-background-location" class="external">Request background location</a></li>
<li><a href="https://developer.android.com/preview/privacy/device-location#periodic-checks-device-
location" class="external">Periodic checks of a device’s location</a></li>
</ul>

<h3 id="in-app-loc-access">In-app location access</h3>

<p>Users can change your app’s access permissions to either <strong>Deny</strong> or <strong>Allow
only while using the app</strong> if they choose. For in-app location access permission, and for all
first-party and third-party apps, provide the levels of user control given in the following table.</p>

<table>
  <tr>
   <th>Permission type app needs to request</th>
   <th>User options to provide</th>
  </tr>
  <tr>
   <td>App requests foreground permissions only</td>
   <td>Allow only while using the app<br>
       Deny
   </td>
  </tr>
  <tr>
   <td>App requests permission always (foreground and background)
   </td>
   <td>Allow all the time<br>
  Allow only while using the app<br>
  Deny
   </td>
  </tr>
  <tr>
   <td>All apps with location access requests
   </td>
   <td>Allow only while using the app
   </td>
  </tr>
</table>

<p>These
permissions apply to all location requests. Apps with <strong>Allow only while using the
app</strong> permissions aren’t allowed background Wi-Fi, cell, or Bluetooth scans.</p>

<h2 id="OS-upgrades">OS upgrades</h2>

<p>On an OS upgrade to Android {{ androidQVersionNumber }}, app location permissions translate according to the following:</p>

<ul>
<li><strong>On</strong> becomes <strong>Allow only while in Use</strong>.</li>
<li><strong>Off</strong> remains off (<strong>Deny</strong>).</li>
<li>Pre-granted location access becomes the <strong>Allow only while in use</strong> pre-grant.</li>
</ul>

</body>
</html>
