<html devsite>
  <head>
    <title>EGLSurfaces and OpenGL ES</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  <body>
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->


<p>Android uses the OpenGL ES (GLES) API to render graphics. To create GLES contexts
and provide a windowing system for GLES renderings, Android uses the EGL
library. GLES calls render textured polygons, while EGL calls put renderings on
screens.</p>

<p>Before you draw with GLES, you need to create a GL context. In EGL,
this means creating an EGLContext and an EGLSurface. GLES operations apply to
the current context, which is accessed through thread-local storage rather than
passed as an argument. Rendering code should execute on a current GLES thread,
not the UI thread.</p>

 <h2 id="egl_surface">EGLSurfaces</h2>

<p>The EGLSurface can be an off-screen buffer allocated by EGL, called a
<em>pbuffer</em>, or a window allocated by the operating system. Calling the
<code>eglCreateWindowSurface()</code> function creates EGL window surfaces.
<code>eglCreateWindowSurface()</code> takes a <em>window object</em> as an
argument, which on Android is a surface. A surface is the <em>producer</em>
side of a BufferQueue. <em>Consumers</em>, which are SurfaceView,
SurfaceTexture, TextureView, or ImageReader, create surfaces.
When you call <code>eglCreateWindowSurface()</code>, EGL creates a new
EGLSurface object and connects it to the producer interface of the window
object's BufferQueue. From that point onward, rendering to that EGLSurface
results in a buffer being dequeued, rendered into, and queued for use by the
consumer.

<aside class="note">Though windows are typically displayed, in this case, the
output of an EGLSurface window may not appear on the display.</aside>

<p>EGL doesn't provide lock/unlock calls. Issue drawing commands and
then call <code>eglSwapBuffers()</code> to submit the current frame. The
method name comes from the traditional swap of front and back buffers, but the actual
implementation may be different.</p>

<p>Only one EGLSurface can be associated with a surface at a time (you can have
only one producer connected to a BufferQueue), but if you destroy the
EGLSurface it disconnects from the BufferQueue and lets something else
connect.</p>

<p>A given thread can switch between multiple EGLSurfaces by changing what's
<em>current</em>. An EGLSurface must be current on only one thread at a time.</p>

<p>EGL isn't another aspect of a surface (like SurfaceHolder).  EGLSurface is a
related but independent concept. You can draw on an EGLSurface that isn't
backed by a surface, and you can use a surface without EGL. EGLSurface just
provides GLES with a place to draw.</p>

<p>Refer to the Android <a href="/compatibility/overview">Compatibility
Definition Document</a> for OpenGL ES and EGL requirements.</p>

<h2 id="anativewindow">ANativeWindow</h2>

<p>The public surface class is implemented in the Java programming language. The
equivalent in C/C++ is the ANativeWindow class, semi-exposed by the <a
href="https://developer.android.com/ndk/index.html" class="external">Android NDK</a>. You
can get the ANativeWindow from a surface with the <code>ANativeWindow_fromSurface()</code>
call. Just like its Java-language cousin, you can lock it, render in software,
and unlock-and-post. The basic <em>native window</em> type is the producer side of a
BufferQueue.</p>

<p>To create an EGL window surface from native code, pass an instance of
EGLNativeWindowType to <code>eglCreateWindowSurface()</code>. EGLNativeWindowType is
a synonym for ANativeWindow, so you can cast one to the other.</p>

  </body>
</html>
