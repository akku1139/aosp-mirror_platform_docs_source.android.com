<html devsite>
  <head>
    <title>CTS Verifier Pro Audio Test</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
  <body>
  <!--
      Copyright 2019 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

{% include "_versions.html" %}

<p>This document describes the Android {{ androidQVersionNumber }} CTS Verifier test for Pro
Audio compliance. While most test activities automatically occur when the test begins,
testing round-trip latency requires human intervention to connect an appropriate peripheral
to the device under test.</p>

<h2 id="installing-the-external-loopback-application">Installing the external loopback application</h2>

<p>The CTS Verifier Pro Audio Test uses the
<a href="https://play.google.com/store/apps/details?id=org.drrickorang.loopback&hl=en_US">Dr.
Rick O'Rang loopback application</a> to measure round-trip latency through the audio path.
This application should be installed using the Play Store link. The source code is available on
<a href="https://github.com/gkasten/drrickorang">GitHub</a>.</p>

<h2 id="assembling-peripherals">Assembling required peripherals</h2>

<p>To measure round-trip latency through the audio path, you must <strong>directly connect</strong>
an appropriate audio peripheral with playback and record functionality to the device under test.</p>

<aside class="note"><b>Note:</b> Because analog, digital, and Bluetooth headsets cannot be directly
   connected to device outputs and inputs, these peripherals are <strong>not considered
   appropriate</strong> and cannot be used for this Pro Audio test.</aside>

<p> An acceptable peripheral can be any one of the following:</p>

<table>
  <tr>
   <td><strong>Description</strong>
   </td>
   <td colspan="2" ><strong>Photo</strong>
   </td>
  </tr>
  <tr>
   <td><strong>USB audio interface</strong><ul>

<li>Can be any USB audio interface that can have its outputs and inputs directly connected to
the device with a patch cable(s).
<li>Any of the <a href="https://source.android.com/compatibility/cts/usb-audio#usb-audio-interface">
mandated USB audio interfaces</a> required by the USB <strong>Audio Peripherals
Play </strong>or<strong> Record CTS Verifier Test</strong> meet this peripheral requirement.</li></ul>

   </td>
   <td colspan="2" >
<img src="/compatibility/cts/images/Pro-Audio0.png" alt="CTS Pro Audio" id="figure1" />
<figcaption><strong>Figure 1.</strong> CTS verifier icon</figcaption>
  </td>
  </tr>

<tr>
   <td><strong>Loopback plug</strong> with:<ul>

<li><strong>USB-C digital to analog adapter<br>
<br>
</strong>OR
<li><strong>3.5mm analog jack</strong></li></ul>

   </td>
   <td>


<img src="/compatibility/cts/images/Pro-Audio1.png" alt="CTS Pro Audio" id="figure2" />
<figcaption><strong>Figure 2.</strong> Loopback plug with USB-C digital-to-analog adapter</figcaption>

   </td>
   <td>

<img src="/compatibility/cts/images/Pro-Audio2.png" alt="CTS Pro Audio" id="figure3" />
<figcaption><strong>Figure 3.</strong> Loopback plug with 3.5mm analog jack</figcaption>

   </td>
  </tr>
</table>


<h2 id="calibrating-the-loopback-app">Calibrating the Loopback app</h2>

<p>Before running the Pro Audio test, you must calibrate the sound levels on the Loopback app.
To perform calibration:</p>
<aside class="note"><b>Note:</b> The calibration steps below are not needed for 3.5 mm analog jack.
They are only needed if using Audiobox USB interface.</aside>
<ol>
<li>Ensure the USB interface peripheral is directly connected to the device under test.
<li>Launch the Loopback app on the device.
<li>Run the function <strong>Calibrate Sound Level Now</strong>.
<li>Adjust the input levels on the USB interface as needed to get a signal level that can
be measured. See <strong>Figure 4</strong> for example.<br>
<br>

<img src="/compatibility/cts/images/Pro-Audio3.jpg" alt="CTS Pro Audio" id="figure4" />
<figcaption><strong>Figure 4.</strong> USB interface input levels (Presonus AudioBox USB shown)</figcaption>

</li></ol>

<p> After calibration is complete, you are ready to run the Pro Audio test. The Loopback app
will retain its calibrated settings until the next device reboot.</p>

<h2 id="running-the-pro-audio-test">Running the Pro Audio test</h2>

<p>To run the CTS Verifier Pro Audio test:</p>

<ol>
<li>Open the <a href="https://source.android.com/compatibility/cts/verifier">CTS
Verifier application on the device</a>.
<li>Select the <strong>Pro Audio</strong> <strong>Test</strong> in the list of tests.
<li>Verify test prerequisites are met (i.e. values are
<strong>true</strong> or <strong>N/A</strong>) on the Pro Audio Test module.
<li>Tap <strong>Round-Trip Test</strong> to start the Loopback
App (which briefly appears onscreen before automatically running the Pro Audio test).

<table>
  <tr>
   <td>

<img src="/compatibility/cts/images/Pro-Audio4.png" alt="CTS Pro Audio" id="figure5" />
<figcaption><strong>Figure 5.</strong> Pro Audio test module</figcaption>

  </td>
   <td>

<img src="/compatibility/cts/images/Pro-Audio5.png" alt="CTS Pro Audio" id="figure6" />
<figcaption><strong>Figure 6.</strong> Loopback app</figcaption>

 </td>
  </tr>
</table>

<li>Wait for the Loopback app to determine the round-trip latency. When the test completes,
the app returns the <strong>Round Trip Latency</strong> measurement and a
<strong>Confidence</strong> value.

<ul>
<li>To get a sufficient <strong>Confidence</strong> value, you might need to run the test more than once.
 <li>When using a USB Interface with input level controls, you need to adjust
 the controls to a non-zero value. This is typically done when calibrating the signal level.

<aside class="note"><b>Note:</b> If the audio interface in use passed the <strong>USB Audio Peripheral
Record test</strong>, the input level setting used in that test should work in this test as well.</aside>

<li>Verify all CDD Pro Audio requirements have been met. For details on latency criteria,
refer to the
<a href="https://source.android.com/compatibility/android-cdd#5_10_professional_audio">
Professional Audio</a> section in the Android CDD.
<li>Tap

<img src="/compatibility/cts/images/Pro-Audio6.png" alt="CTS Pro Audio" id="figure7" />
<strong></strong>to indicate compliance.


  </body>
</html>
