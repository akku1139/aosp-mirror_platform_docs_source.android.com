<html devsite>
  <head>
    <title>Running CTS tests</title>
    <meta name="project_path" value="/_project.yaml" />
    <meta name="book_path" value="/_book.yaml" />
  </head>
    {% include "_versions.html" %}
  <body>
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->


<p>Trade Federation is a continuous test framework for running tests on
  Android devices. To run the Compatibility Test Suite (CTS), first read
  the <a href="/devices/tech/test_infra/tradefed/">Trade Federation
  Overview</a> for an explanation of Tradefed test framework.</p>

<p>To run a test plan:</p>
<ol>
  <li>Set up Devices Under Test (DUTs) as per <a href="/compatibility/cts/setup#device_setup">
  Android device setup</a>.
  </li>
  <li>Download the <a href="/compatibility/cts/downloads">released CTS builds</a>
  onto your Linux host machine and unzip the build to host location.
  </li>
  <li>Connect at least one device. To prepare the DUT:
    <ul>
      <li>Press the <strong>home</strong> button to set the device to the home
        screen.</li>
      <li>Don't use the DUT for any other tasks.</li>
      <li>Keep the DUT in a stationary position to avoid triggering sensor
        activity.</li>
      <li>Point the device camera at an object that can be focused.</li>
      <li>Do not press any keys on the device while the CTS is running.
        Pressing keys or touching the screen of a DUT interferes with the
        running tests and may lead to test failures.</li>
    </ul>
  </li>
  <li>Launch the CTS console <em>cts-tradefed</em> script from
  the folder where the CTS package has been unzipped. On the host's
    command-line shell, run:
    <pre class="devsite-terminal devsite-click-to-copy">./android-cts/tools/cts-tradefed</pre>
  </li>
  <li>Run the default test plan (contains all test packages):
  <pre class="devsite-terminal devsite-click-to-copy">cts-tradefed &gt; run cts</pre>
    <ul>
      <li>If you want to improve test execution time, you can
        <a href="/devices/tech/test_infra/tradefed/testing/through-suite/android-test-tuning">
          shard the tests</a> across multiple devices. Sharding requires the
        host to connect at least two devices, but six or more devices are
        recommended for efficiency. When sharding more than 1 device:
        <ul>
          <li>For Android 9 and higher, use the command option
            <pre class="devsite-click-to-copy">--shard-count <var>number_of_shards</var></pre>
          </li>
          <li>For Android 8.1 and lower, use the command option
            <pre class="devsite-click-to-copy">--shards <var>number_of_shards</var></pre>
          </li>
        </ul>
      </li>
      <li>If you don't want to run the whole test suite, you can run the
        <a href="#selecting_ctsv2_plans">CTS plan</a> of your choice from the
        command line:
    <pre class="devsite-terminal devsite-click-to-copy">run cts --plan <var>test_plan_name</var></pre>
        <p>To find the test plan name:</p>
      <ul>
        <li>For Android 7.0 and higher, to see a list of test modules, enter
          <pre class="devsite-click-to-copy">list modules</pre></li>
        <li>For Android 6.0 and lower, to view a list of test plans in the
          repository, enter
          <pre class="devsite-click-to-copy">list plans</pre></li>
        <li>For Android 6.0 and lower, to view a list of test packages in the
          repository, enter
        <pre class="devsite-click-to-copy">list packages</pre></li>
      </ul>
      <li>For additional command options depending on CTS versions, refer to
        the <a href="#using-cts-v2">console command references</a> below, or
        under "help all" in the Tradefed console.
        <aside class="note"><strong>Note:</strong> You may save run time in
          Android 7.0 (Nougat) and higher, by using the
          <code>run cts-dev</code> command instead of <code>run cts</code>.
          This command skips preconditions, device-information collection, and
          all system status checkers. It also runs the tests on only a single
          ABI. For device validation, avoid this optimization and include all
          preconditions and checks.</aside>
      </li>
    </ul>
  </li>
  <li>Run multiple Retry sessions until all test modules are completed and the
    test failure numbers are the same in the last two retry sessions.
    <ul>
      <li>For Android 9 and higher, use
        <pre class="devsite-terminal devsite-click-to-copy">run retry --retry <var>session_number</var> --shard-count <var>number_of_shards</var></pre>
      </li>
      <li>For Android 7.0&ndash;8.1, use
        <pre class="devsite-terminal devsite-click-to-copy">run cts --retry <var>session_number</var> --shards <var>number_of_shards</var></pre>
      </li>
      <li>For additional Retry command options depending on CTS version, see
        the <a href="#using-cts-v2">Using the CTS v2 console</a> section below.
      </li>
      <li>fTo understand implementation details for CTS retry, see
        <a href="/devices/tech/test_infra/tradefed/testing/through-suite/suite-retry">
          Trade Federation Suite Retry</a>.</li>
    </ul>
  </li>
  <li>View test progress and results reported on the console.</li>
</ol>

<h2 id="using-cts-v2">Using the CTS v2 console</h2>

<p>For Android 7.0 or higher, use CTS v2.</p>

<h3 id="selecting_ctsv2_plans">Selecting plans</h3>
<p>Available test plans include the following:</p>
<ul>
  <li><em>cts</em>—Runs CTS from an pre-existing CTS installation.</li>
  <li><em>cts-camera</em>— Runs CTS-camera from a pre-existing CTS installation.</li>
  <li><em>cts-java</em>— Runs Core Java Tests from a pre-existing CTS installation.</li>
  <li><em>cts-pdk</em>— Runs Tests useful on validating a PDK fusion build.</li>
  <li><em>everything</em>— Common config for Compatibility suites.</li>
</ul>
<p>Other available configurations include the following:</p>
<ul>
  <li><em>basic-reporters</em>— Configuration with basic CTS reporters.</li>
  <li><em>collect-tests-only</em>—Runs CTS from a pre-existing CTS installation.</li>
  <li><em>common-compatibility-config</em>— Common config for Compatibility suites.</li>
  <li><em>cts-filtered-sample</em>— Common config for Compatibility suites.</li>
  <li><em>cts-known-failures</em>— Configuration with CTS known failures.</li>
  <li><em>cts-preconditions</em>— CTS precondition configs.</li>
  <li><em>host</em>— Runs a single host-based test on an existing device.</li>
  <li><em>instrument</em>— Runs a single Android instrumentation test on an existing device.</li>
  <li><em>native-benchmark</em>— Runs a native stress test on an existing device.</li>
  <li><em>native-stress</em>— Runs a native stress test on an existing device.</li>
  <li><em>recharge</em>— A fake test that waits for nearly-discharged devices and holds them for charging.</li>
  <li><em>testdef</em>— Runs tests contained in test_def.xml files on an existing device.</li>
  <li><em>util/wifi</em>— Utility config to configure Wi-Fi on device.</li>
  <li><em>util/wipe</em>— Wipes user data on device.</li>
</ul>
<p>All of these plans and configs can be executed with the <code>run cts</code> command.</p>

<h3 id=ctsv2_reference>CTS v2 console command reference</h3>

<p class="table-caption" id="console-commands">
  <strong>Table 1.</strong> This table summarizes the CTS V2 console commands for
various uses.</p>
<table>
  <tbody>
    <tr>
      <th>Host</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>help</code></td>
      <td>Display a summary of the most commonly used commands</td>
    </tr>
    <tr>
      <td><code>help all</code></td>
      <td>Display the complete list of available commands</td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>Show the version.</td>
    </tr>
    <tr>
      <td><code>exit</code></td>
      <td>Gracefully exit the CTS console. Console closes when all
        currently running tests are finished.</td>
    </tr>
    <tr>
      <th>Run</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>run cts</code></td>
      <td><p>In Android {{ androidQVersionNumber }}, run the default CTS plan and CTS-Instant
      together (that is, the full CTS invocation). For Android 9 and lower, run the default
      CTS plan only. Use this comprehensive option (including preconditions) for device validation.
        See <a
        href="https://android.googlesource.com/platform/test/suite_harness/+/master/tools/cts-tradefed/res/config/cts.xml"
               class="external">cts.xml</a> for inclusions.</p>
        <p>The CTS console can accept other commands while tests are in progress.</p>
        <p>If no devices are connected, the CTS desktop machine (or host) will wait
        for a device to be connected before starting tests. If more than one
        device is connected, the CTS host will choose a device
        automatically.</p>
    </tr>
    <tr>
      <td><code>run cts-instant</code></td>
      <td><p>For Android 9, run the default CTS-Instant plan.</p>
    </tr>
    <tr>
      <td><code>run cts --module-parameter INSTANT_APP</code></td>
      <td><p>In Android {{ androidQVersionNumber }}, run the default CTS-Instant plan.</p>
    </tr>
    <tr>
      <td><code>run cts --module-parameter INSTANT_APP --module/-m <var>test_module_name</var></code></td>
      <td><p>In Android {{ androidQVersionNumber }}, run the specified CTS-Instant test module
      or modules.</p></td>
    </tr>
    <tr>
      <td><code>run retry</code></td>
      <td><p>For Android 9 and higher only. Retry all the tests that failed or weren't executed
      from the previous sessions. For example, <code>run retry --retry -s</code> or <code>run
      retry --retry --shard-count</code> with TF sharding. <code>run cts --retry</code> isn't
      allowed for Android 9 and higher.</p></td>
      </tr>
    <tr>
      <td><code>--device-token</code></td>
      <td><p>For Android 8.1 and lower versions. Specifies that a given device has the given
        token. For example, <code>--device-token 1a2b3c4d:sim-card</code>.</p></td>
    </tr>
    <tr>
      <td><code>--enable-token-sharding</code></td>
      <td><p>For Android {{ androidQVersionNumber }} only. Automatically matches the test that
      requires respective SIM type. No need to provide a device serial number to execute
      SIM-related test cases. Supported SIMs: <code>SIM_CARD</code>, <code>UICC_SIM_CARD</code>,
      and <code>SECURE_ELEMENT_SIM_CARD</code>.</p>
    </tr>
    <tr>
    <td><code>run cts-dev</code></td>
      <td><p>Run the default CTS plan (that is, the full CTS invocation) but
        skip preconditions to save run time for iterative development of a new
        test. This bypasses verification and setup of the device's
        configuration, such as pushing media files or checking for Wi-Fi
        connection, as is done when the <code>--skip-preconditions</code> option is used. This
        command also skips device-information collection, and all system status checkers. It also
        runs the tests on only a single ABI. For device validation, avoid this optimization and
        include all preconditions and checks. See
        <a href="https://android.googlesource.com/platform/test/suite_harness/+/master/tools/cts-tradefed/res/config/cts-dev.xml"
           class="external">cts-dev.xml</a> for exclusions.</p>
        <p>The CTS console can accept other commands while tests are in progress.</p>
        <p>If no devices are connected, the CTS desktop machine (or host) will wait
        for a device to be connected before starting tests. If more than one
        device is connected, the CTS host will choose a device
        automatically.</p></td>
    </tr>
    <tr>
      <td><code>run retry</code></td>
      <td><p><strong>For Android 9</strong>. Retry all tests that failed or were not executed from the
        previous sessions. For example,
        <code>run retry --retry <var>session id</var> -s<var>device serial</var></code>,
        or <code>run retry --retry <var>session id</var> --shard-count</code> with TF sharding.</p>
        <p><code>run cts --retry</code> is not allowed for Android 9.</td>
    </tr>
    <tr>
      <td><code>--plan <var>test_plan_name</var></code></td>
      <td>Run the specified test plan.</td>
    </tr>
    <tr>
      <td><code>--module/-m <var>test_module_name</var>  [--module/-m <var>test_module2</var>...]</code></td>
      <td>Run the specified test module or modules. For example, <code>run cts --module CtsGestureTestCases</code>
          executes the gesture test module (this can be shortened to <code>run cts -m Gesture</code>).<br>
          <code>run cts -m Gesture --test android.gesture.cts.GestureTest#testGetStrokes</code> runs the specific
          package, class, or test.</td>
    </tr>
    <tr>
      <td><code>--subplan  <var>subplan_name</var></code></td>
      <td>Run the specified subplan.</td>
    </tr>
    <tr>
      <td><code>-- module/-m <var>test_module_name</var> -- test <var>test_name</var> </code></td>
      <td>Run the specified module and test. For example,
        <code>run cts -m Gesture --test android.gesture.cts.GestureTest#testGetStrokes</code>
        runs the specific package, class, or test.</td>
    </tr>
    <tr>
      <td><code>--retry</code></td>
      <td>Retry all tests that failed or were not executed from the previous sessions.
          Use <code>list results</code> to get the session id.</td>
    </tr>
    <tr>
      <td><code>--retry-type not_executed</code></td>
      <td>Retry only tests that were not executed from the previous sessions.
          Use <code>list results</code> to get the session id.</td>
    </tr>
    <tr>
      <td><code>--shards <var>number_of_shards</var></code></td>
      <td><strong>For Android 8.1 and lower versions</strong>. Shard a CTS
        run into given number of independent chunks, to run on multiple devices
        in parallel.</td>
    </tr>
    <tr>
      <td><code>--shard-count <var>number_of_shards</var></code></td>
      <td><strong>For Android 9</strong>. Shard a CTS run into given number of
        independent chunks, to run on multiple devices in parallel.</td>
    </tr>
    <tr>
      <td><code>--serial/-s <var>deviceID</var></code></td>
      <td>Run CTS on the specific device.</td>
    </tr>
    <tr>
      <td><code>--include-filter <var>module_name</var>  [--include-filter <var>module2</var>...]</code></td>
      <td>Run only with the specified modules.</td>
    </tr>
    <tr>
      <td><code>--exclude-filter <var>module_name</var>  [--exclude-filter <var>module2</var>...]</code></td>
      <td>Exclude the specified modules from the run.</td>
    </tr>
    <tr>
      <td><code>--log-level-display/-l <var>log_level</var></code></td>
      <td>Run with the minimum specified log level displayed to
        <code>STDOUT</code>. Valid values: [<code>VERBOSE</code>,
        <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>,
        <code>ERROR</code>, <code>ASSERT</code>].</td>
    </tr>
    <tr>
      <td><code>--abi <var>abi_name</var></code></td>
      <td>Force the test to run on the given ABI, 32 or 64. By default CTS
        runs a test once for each ABI the device supports.</td>
    </tr>
    <tr>
      <td><code>--logcat</code>, <code>--bugreport</code>, and
        <code>--screenshoot-on-failure</code></td>
      <td>Give more visibility into failures and can help with diagnostics.</td>
    </tr>
    <tr>
      <td><code>--device-token</code></td>
      <td>Specifies a given device has the given token, such as
        <code>--device-token 1a2b3c4d:sim-card</code>.</td>
    </tr>
    <tr>
      <td><code>--skip-device-info</code></td>
      <td>Skips collection of information about the device.
        <aside class="caution"><strong>Caution</strong>: Don't use this option
          when running CTS for approval.</aside></td>
    </tr>
    <tr>
      <td><code>--skip-preconditions</code></td>
      <td>Skip preconditions to save run time for iterative development of a
        new test. This bypasses verification and setup of the device's
        configuration, such as pushing media files or checking for Wi-Fi
        connection.</td>
    </tr>
    <tr>
      <th>List</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>list modules</code></td>
      <td>List all available test modules in the repository.</td>
    </tr>
    <tr>
      <td><code>list plans</code> or <code>list configs</code></td>
      <td>List all available test plans (configs) in the repository.</td>
    </tr>
    <tr>
      <td><code>list subplans</code></td>
      <td>List all available subplans in the repository.</td>
    </tr>
    <tr>
      <td><code>list invocations</code></td>
      <td>List 'run' commands currently being executed on devices.</td>
    </tr>
    <tr>
      <td><code>list commands</code></td>
      <td>List all 'run' commands currently in the queue waiting to be assigned to devices.</td>
    </tr>
    <tr>
      <td><code>list results</code></td>
      <td>List CTS results currently stored in repository.</td>
    </tr>
    <tr>
      <td><code>list devices</code></td>
      <td>List currently connected devices and their state.
        <p> </p>
        <p>'Available' devices are functioning, idle devices, available for running tests.</p>
        <p> </p>
        <p>'Unavailable' devices are devices visible via adb, but are not responding to adb commands and won't be allocated for tests.</p>
        <p> </p>
        <p>'Allocated' devices are devices currently running tests.</td>
    </tr>
    <tr>
      <th>Dump</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>dump logs</code></td>
      <td>Dump the tradefed logs for all running invocations.</td>
    </tr>
    <tr>
      <th>Add</th>
      <th>Description</th>
    </tr>
    <tr>
      <td><code>add subplan --name/-n <var>subplan_name</var><br>
        --result-type<br>
        [pass | fail | timeout | notExecuted]<br>
        [--session/-s <var>session_id</var>]</code></td>
      <td>Create a subplan derived from previous session; this option generates
        a subplan that can be used to run a subset of tests.<br><br> The only
        required option is <code>--session</code>. Others are optional but, when
        included, must be followed by a value.  The
        <code>--result-type</code> option is repeatable; for example
        <code>add subplan --session 0 --result-type passed --result-type
        failed</code> is valid.</td>

    </tr>
  </tbody>
</table>

<h2 id=using-cts-v1>Using the CTS v1 console</h2>
<p>For Android 6.0 or lower, refer to <a href="/compatibility/cts/command_console">CTS v1
Command Console Reference.</a></p>

  </body>
</html>
